<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nabha HealthConnect - Enhanced Rural Telemedicine Platform</title>

    <!-- PWA Configuration -->
    <meta name="theme-color" content="#1976D2" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Nabha HealthConnect" />
    <link rel="manifest" href="manifest.json" />

    <!-- Preload critical resources -->
    <link rel="preload" href="#" as="style" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <style>
      /* Enhanced CSS with Professional Healthcare Design */

      /* CSS Reset and Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-blue: #1976d2;
        --light-blue: #e3f2fd;
        --dark-blue: #0d47a1;
        --accent-blue: #2196f3;
        --white: #ffffff;
        --light-gray: #f8f9fa;
        --medium-gray: #e9ecef;
        --dark-gray: #6c757d;
        --text-dark: #212529;
        --text-light: #6c757d;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #17a2b8;
        --border-color: #dee2e6;

        /* Shadows */
        --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);

        /* Border Radius */
        --border-radius: 0.5rem;
        --border-radius-lg: 1rem;
        --border-radius-xl: 1.5rem;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
        background: linear-gradient(
          135deg,
          var(--light-blue) 0%,
          var(--white) 100%
        );
        min-height: 100vh;
      }

      /* Header with Logo and Branding */
      .site-header {
        background: linear-gradient(
          135deg,
          var(--primary-blue) 0%,
          var(--dark-blue) 100%
        );
        color: var(--white);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: var(--shadow);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo {
        width: 48px;
        height: 48px;
        background: var(--white);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: var(--shadow-sm);
      }

      .brand-text {
        display: flex;
        flex-direction: column;
      }

      .brand-title {
        font-size: 1.25rem;
        font-weight: 700;
        line-height: 1.2;
      }

      .brand-subtitle {
        font-size: 0.875rem;
        opacity: 0.9;
        font-weight: 400;
      }

      /* Language Selector */
      .language-selector {
        display: flex;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius);
        padding: 0.25rem;
      }

      .lang-btn {
        background: transparent;
        border: none;
        color: var(--white);
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .lang-btn.active {
        background: var(--white);
        color: var(--primary-blue);
        box-shadow: var(--shadow-sm);
      }

      .lang-btn:hover:not(.active) {
        background: rgba(255, 255, 255, 0.1);
      }

      /* Hero Section */
      .hero-section {
        background: url('https://static.toiimg.com/thumb/resizemode-4,width-1280,height-720,msid-70124246/70124246.jpg')
            center/cover;
        padding: 3rem 0;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .hero-content {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      .hero-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-blue);
        margin-bottom: 1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .hero-subtitle {
        font-size: 1.25rem;
        color: var(--text-light);
        margin-bottom: 2rem;
        font-weight: 400;
      }

      .hero-stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .stat-item {
        text-align: center;
        background: var(--white);
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        min-width: 140px;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-blue);
        display: block;
      }

      .stat-label {
        font-size: 0.875rem;
        color: var(--text-light);
        margin-top: 0.5rem;
      }

      /* Navigation Grid with Medical Icons */
      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .nav-section {
        margin-bottom: 3rem;
      }

      .section-title {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--text-dark);
        text-align: center;
        margin-bottom: 2rem;
      }

      .nav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1.5rem;
      }

      .nav-card {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 2rem 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow);
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .nav-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-blue);
        transform: scaleX(0);
        transition: transform 0.3s ease;
      }

      .nav-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-blue);
      }

      .nav-card:hover::before {
        transform: scaleX(1);
      }

      .nav-card.active {
        border-color: var(--primary-blue);
        background: var(--light-blue);
      }

      .nav-card.active::before {
        transform: scaleX(1);
      }

      .nav-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 1rem;
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--accent-blue)
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: var(--white);
        box-shadow: var(--shadow-sm);
      }

      .nav-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
      }

      .nav-description {
        font-size: 0.875rem;
        color: var(--text-light);
        line-height: 1.4;
      }

      /* Content Sections */
      .content-section {
        display: none;
        background: var(--white);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        margin: 2rem 0;
        overflow: hidden;
      }

      .content-section.active {
        display: block;
      }

      .section-header {
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--accent-blue)
        );
        color: var(--white);
        padding: 2rem;
        text-align: center;
      }

      .section-header h2 {
        font-size: 1.75rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .section-header p {
        opacity: 0.9;
        font-size: 1rem;
      }

      .section-body {
        padding: 2rem;
      }

      /* Enhanced Form Styles */
      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: all 0.3s ease;
        background: var(--white);
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
      }

      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }

      /* Enhanced Button Styles */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.875rem 1.5rem;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        gap: 0.5rem;
        min-height: 48px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--accent-blue)
        );
        color: var(--white);
        box-shadow: var(--shadow);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .btn-secondary {
        background: var(--white);
        color: var(--primary-blue);
        border: 2px solid var(--primary-blue);
      }

      .btn-secondary:hover {
        background: var(--primary-blue);
        color: var(--white);
      }

      .btn-success {
        background: var(--success);
        color: var(--white);
      }

      .btn-danger {
        background: var(--danger);
        color: var(--white);
      }

      .btn-block {
        width: 100%;
      }

      /* Enhanced Symptom Checker */
      .symptom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
      }

      .symptom-card {
        background: var(--light-gray);
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .symptom-card:hover {
        border-color: var(--primary-blue);
        transform: translateY(-2px);
      }

      .symptom-card.selected {
        background: var(--primary-blue);
        color: var(--white);
        border-color: var(--primary-blue);
      }

      .symptom-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        display: block;
      }

      .symptom-label {
        font-weight: 600;
        font-size: 0.875rem;
      }

      /* Results and Cards */
      .result-card {
        background: var(--light-blue);
        border: 1px solid var(--primary-blue);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin: 1rem 0;
        border-left: 4px solid var(--primary-blue);
      }

      .result-card.warning {
        background: #fff3cd;
        border-color: var(--warning);
        border-left-color: var(--warning);
      }

      .result-card.danger {
        background: #f8d7da;
        border-color: var(--danger);
        border-left-color: var(--danger);
      }

      .card {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-sm);
        margin: 1rem 0;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .card-header {
        background: var(--light-gray);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
      }

      .card-body {
        padding: 1.5rem;
      }

      .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-dark);
      }

      .card-text {
        color: var(--text-light);
        line-height: 1.6;
      }

      /* Status Indicators */
      .status {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .status.online {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
      }

      .status.offline {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
      }

      .status.busy {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
      }

      /* Video Consultation */
      .video-container {
        background: #000;
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        margin: 1rem 0;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.2rem;
        position: relative;
      }

      .video-placeholder {
        text-align: center;
        padding: 2rem;
      }

      .video-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
      }

      /* Emergency Section */
      .emergency-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
      }

      .emergency-card {
        background: var(--danger);
        color: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: var(--shadow);
      }

      .emergency-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .emergency-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        display: block;
      }

      .emergency-title {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }

      .emergency-number {
        font-size: 1.5rem;
        font-weight: 700;
      }

      /* Loading States */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid var(--border-color);
        border-top: 3px solid var(--primary-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      /* Offline Indicator */
      .offline-indicator {
        background: var(--warning);
        color: var(--white);
        text-align: center;
        padding: 0.75rem;
        font-weight: 600;
        display: none;
      }

      /* Footer */
      .site-footer {
        background: var(--dark-blue);
        color: var(--white);
        padding: 2rem 0;
        margin-top: 3rem;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
      }

      .footer-section h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .footer-section p,
      .footer-section a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        line-height: 1.6;
      }

      .footer-section a:hover {
        color: var(--white);
      }

      .footer-bottom {
        text-align: center;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.6);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .hero-title {
          font-size: 2rem;
        }

        .hero-subtitle {
          font-size: 1rem;
        }

        .hero-stats {
          flex-direction: column;
          align-items: center;
        }

        .nav-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .section-body {
          padding: 1rem;
        }

        .header-content {
          flex-direction: column;
          gap: 1rem;
        }
      }

      @media (max-width: 480px) {
        .nav-grid {
          grid-template-columns: 1fr;
        }

        .symptom-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .btn {
          padding: 0.75rem 1rem;
          font-size: 0.875rem;
        }
      }

      /* Accessibility */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Focus styles for better accessibility */
      .nav-card:focus,
      .btn:focus,
      .form-input:focus,
      .form-select:focus {
        outline: 2px solid var(--primary-blue);
        outline-offset: 2px;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        :root {
          --border-color: #000;
          --text-light: #000;
        }
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Added styles for voice recorder */
      .voice-recorder-container {
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        background: var(--light-gray);
        transition: all 0.3s ease;
      }

      .voice-recorder-container.recording {
        border-color: var(--danger);
        background: rgba(220, 53, 69, 0.1);
      }

      .voice-controls {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .recording-status {
        margin-top: 1rem;
        padding: 0.75rem;
        background: var(--danger);
        color: white;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .recording-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .recording-dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .recording-preview {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--success);
        color: white;
        border-radius: 6px;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      /* Added chatbot widget styles */
      .chatbot-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 350px;
        max-width: calc(100vw - 40px);
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
        z-index: 1000;
        font-family: inherit;
      }

      .chatbot-header {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: var(--primary-blue);
        color: white;
        border-radius: 12px 12px 0 0;
        cursor: pointer;
        user-select: none;
      }

      .chatbot-avatar {
        font-size: 1.5rem;
        margin-right: 0.75rem;
      }

      .chatbot-title {
        flex: 1;
      }

      .chatbot-title span {
        font-weight: 600;
        font-size: 1rem;
      }

      .chatbot-status {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        opacity: 0.9;
        margin-top: 0.25rem;
      }

      .chatbot-toggle {
        background: none;
        border: none;
        color: white;
        font-size: 1.25rem;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .chatbot-toggle:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .chatbot-container {
        height: 400px;
        display: flex;
        flex-direction: column;
      }

      .chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .message {
        display: flex;
        gap: 0.5rem;
        max-width: 85%;
      }

      .message.user-message {
        align-self: flex-end;
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        flex-shrink: 0;
      }

      .bot-message .message-avatar {
        background: var(--light-blue);
      }

      .user-message .message-avatar {
        background: var(--primary-blue);
        color: white;
      }

      .message-content {
        background: var(--light-gray);
        padding: 0.75rem;
        border-radius: 12px;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .user-message .message-content {
        background: var(--primary-blue);
        color: white;
      }

      .chatbot-input-container {
        border-top: 1px solid var(--border-color);
        padding: 1rem;
      }

      .chatbot-suggestions {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }

      .suggestion-btn {
        background: var(--light-blue);
        color: var(--primary-blue);
        border: 1px solid var(--primary-blue);
        padding: 0.5rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .suggestion-btn:hover {
        background: var(--primary-blue);
        color: white;
      }

      .chatbot-input-area {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }

      .chatbot-input {
        flex: 1;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        font-size: 0.9rem;
        outline: none;
      }

      .chatbot-input:focus {
        border-color: var(--primary-blue);
      }

      .chatbot-voice-btn,
      .chatbot-send-btn {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        transition: all 0.2s;
      }

      .chatbot-voice-btn {
        background: var(--light-gray);
        color: var(--text-dark);
      }

      .chatbot-voice-btn:hover {
        background: var(--medium-gray);
      }

      .chatbot-send-btn {
        background: var(--primary-blue);
        color: white;
      }

      .chatbot-send-btn:hover {
        background: var(--dark-blue);
      }

      @media (max-width: 768px) {
        .chatbot-widget {
          width: calc(100vw - 20px);
          right: 10px;
          bottom: 10px;
        }

        .chatbot-container {
          height: 350px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
      <span data-translate="offline"
        >⚠️ You are currently offline. Some features may be limited.</span
      >
    </div>

    <!-- Header with Enhanced Branding -->
    <header class="site-header">
      <div class="header-content">
        <div class="brand">
          <div class="logo" aria-label="Nabha HealthConnect Logo">🏥</div>
          <div class="brand-text">
            <div class="brand-title" data-translate="app_title">
              Nabha HealthConnect
            </div>
            <div class="brand-subtitle" data-translate="app_subtitle">
              Rural Telemedicine Platform
            </div>
          </div>
        </div>
        <div
          class="language-selector"
          role="group"
          aria-label="Language Selection"
        >
          <button
            class="lang-btn active"
            onclick="changeLanguage('en')"
            data-lang="en"
          >
            English
          </button>
          <button
            class="lang-btn"
            onclick="changeLanguage('hi')"
            data-lang="hi"
          >
            हिंदी
          </button>
          <button
            class="lang-btn"
            onclick="changeLanguage('pa')"
            data-lang="pa"
          >
            ਪੰਜਾਬੀ
          </button>
        </div>
      </div>
    </header>

    <!-- Enhanced Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title" data-translate="hero_title">
          Connecting 173 Villages with Quality Healthcare
        </h1>
        <p class="hero-subtitle" data-translate="hero_subtitle">
          Access doctors, book appointments, and get medical assistance from
          your smartphone - even offline
        </p>

        <div class="hero-stats">
          <div class="stat-item">
            <span class="stat-number">173</span>
            <span class="stat-label" data-translate="villages_served"
              >Villages Served</span
            >
          </div>
          <div class="stat-item">
            <span class="stat-number">24/7</span>
            <span class="stat-label" data-translate="emergency_support"
              >Emergency Support</span
            >
          </div>
          <div class="stat-item">
            <span class="stat-number">3</span>
            <span class="stat-label" data-translate="languages_supported"
              >Languages</span
            >
          </div>
          <div class="stat-item">
            <span class="stat-number">100%</span>
            <span class="stat-label" data-translate="offline_capable"
              >Offline Capable</span
            >
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Enhanced Navigation with Medical Icons -->
      <section class="nav-section">
        <h2 class="section-title" data-translate="services_title">
          Healthcare Services
        </h2>
        <div class="nav-grid">
          <div
            class="nav-card active"
            onclick="showSection('symptom-checker')"
            role="button"
            tabindex="0"
            aria-label="AI Symptom Checker"
          >
            <div class="nav-icon">🔍</div>
            <div class="nav-title" data-translate="symptom_checker">
              AI Symptom Checker
            </div>
            <div class="nav-description" data-translate="symptom_checker_desc">
              Get preliminary diagnosis based on your symptoms
            </div>
          </div>

          <div
            class="nav-card"
            onclick="showSection('appointments')"
            role="button"
            tabindex="0"
            aria-label="Book Appointment"
          >
            <div class="nav-icon">📅</div>
            <div class="nav-title" data-translate="appointments">
              Book Appointment
            </div>
            <div class="nav-description" data-translate="appointments_desc">
              Schedule consultation with specialists
            </div>
          </div>

          <div
            class="nav-card"
            onclick="showSection('medicine')"
            role="button"
            tabindex="0"
            aria-label="Medicine Availability"
          >
            <div class="nav-icon">💊</div>
            <div class="nav-title" data-translate="medicine">
              Medicine Finder
            </div>
            <div class="nav-description" data-translate="medicine_desc">
              Check availability at nearby pharmacies
            </div>
          </div>

          <div
            class="nav-card"
            onclick="showSection('records')"
            role="button"
            tabindex="0"
            aria-label="Health Records"
          >
            <div class="nav-icon">📋</div>
            <div class="nav-title" data-translate="health_records">
              Health Records
            </div>
            <div class="nav-description" data-translate="health_records_desc">
              Access your digital medical history
            </div>
          </div>

          <div
            class="nav-card"
            onclick="showSection('video-consult')"
            role="button"
            tabindex="0"
            aria-label="Video Consultation"
          >
            <div class="nav-icon">💻</div>
            <div class="nav-title" data-translate="video_consult">
              Video Consultation
            </div>
            <div class="nav-description" data-translate="video_consult_desc">
              Connect with doctors via video call
            </div>
          </div>

          <div
            class="nav-card"
            onclick="showSection('emergency')"
            role="button"
            tabindex="0"
            aria-label="Emergency Services"
          >
            <div class="nav-icon">🚨</div>
            <div class="nav-title" data-translate="emergency">Emergency</div>
            <div class="nav-description" data-translate="emergency_desc">
              Quick access to emergency services
            </div>
          </div>
        </div>
      </section>

      <!-- Enhanced Content Sections -->

      <!-- AI Symptom Checker Section -->
      <section id="symptom-checker" class="content-section active">
        <div class="section-header">
          <h2 data-translate="symptom_checker_title">
            🔍 AI-Powered Symptom Checker
          </h2>
          <p data-translate="symptom_checker_subtitle">
            Select your symptoms below for preliminary medical guidance
          </p>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label class="form-label" data-translate="select_symptoms"
              >Select Your Symptoms:</label
            >
            <div class="symptom-grid">
              <div
                class="symptom-card"
                onclick="toggleSymptom('fever')"
                data-symptom="fever"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">🤒</div>
                <div class="symptom-label" data-translate="fever">Fever</div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('cough')"
                data-symptom="cough"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">😷</div>
                <div class="symptom-label" data-translate="cough">Cough</div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('headache')"
                data-symptom="headache"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">🤕</div>
                <div class="symptom-label" data-translate="headache">
                  Headache
                </div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('stomach_pain')"
                data-symptom="stomach_pain"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">🤢</div>
                <div class="symptom-label" data-translate="stomach_pain">
                  Stomach Pain
                </div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('body_ache')"
                data-symptom="body_ache"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">💪</div>
                <div class="symptom-label" data-translate="body_ache">
                  Body Ache
                </div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('breathing_difficulty')"
                data-symptom="breathing_difficulty"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">🫁</div>
                <div
                  class="symptom-label"
                  data-translate="breathing_difficulty"
                >
                  Breathing Issues
                </div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('dizziness')"
                data-symptom="dizziness"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">😵‍💫</div>
                <div class="symptom-label" data-translate="dizziness">
                  Dizziness
                </div>
              </div>
              <div
                class="symptom-card"
                onclick="toggleSymptom('fatigue')"
                data-symptom="fatigue"
                role="button"
                tabindex="0"
              >
                <div class="symptom-icon">😴</div>
                <div class="symptom-label" data-translate="fatigue">
                  Fatigue
                </div>
              </div>
            </div>
          </div>

          <button
            class="btn btn-primary btn-block"
            onclick="analyzeSymptoms()"
            data-translate="analyze_symptoms"
          >
            🔬 Analyze Symptoms
          </button>

          <div id="symptom-results" style="display: none">
            <h3
              style="margin: 2rem 0 1rem 0; color: var(--primary-blue)"
              data-translate="analysis_results"
            >
              Analysis Results:
            </h3>
            <div id="diagnosis-result" class="result-card"></div>
            <div id="recommendation-result" class="result-card"></div>
            <div id="urgency-result" class="result-card"></div>
          </div>
        </div>
      </section>

      <!-- Enhanced Appointments Section with Voice Recorder and Consultant ID -->
      <section id="appointments" class="content-section">
        <div class="section-header">
          <h2 data-translate="book_appointment">📅 Book Medical Appointment</h2>
          <p data-translate="appointment_subtitle">
            Schedule a consultation with our experienced doctors
          </p>
        </div>
        <div class="section-body">
          <form id="appointment-form">
            <div class="form-group">
              <label class="form-label" data-translate="patient_name"
                >Patient Name:</label
              >
              <input
                type="text"
                class="form-input"
                id="patient-name"
                required
                placeholder="Enter full name"
                aria-describedby="name-help"
              />
              <small
                id="name-help"
                style="color: var(--text-light); font-size: 0.875rem"
                >Enter the patient's full name as per ID proof</small
              >
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="phone_number"
                >Phone Number:</label
              >
              <input
                type="tel"
                class="form-input"
                id="phone-number"
                required
                placeholder="+91-XXXXX-XXXXX"
                pattern="[+][9][1]-[0-9]{5}-[0-9]{5}"
              />
            </div>

            <!-- Added consultant ID field after phone number -->
            <div class="form-group">
              <label class="form-label" data-translate="consultant_id"
                >Consultant ID (if available):</label
              >
              <div style="display: flex; gap: 1rem; align-items: center">
                <input
                  type="text"
                  class="form-input"
                  id="consultant-id"
                  placeholder="Enter consultant ID"
                  style="flex: 1"
                />
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    white-space: nowrap;
                  "
                >
                  <input
                    type="checkbox"
                    id="no-consultant-id"
                    onchange="toggleConsultantId()"
                  />
                  <span data-translate="no_consultant_id"
                    >I don't have one</span
                  >
                </label>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="village_name"
                >Village Name:</label
              >
              <input
                type="text"
                class="form-input"
                id="village-name"
                required
                placeholder="Enter village name"
                list="villages"
              />
              <datalist id="villages">
                <option value="Amloh"></option>
                <option value="Bhadson"></option>
                <option value="Nabha"></option>
                <option value="Patran"></option>
                <option value="Rajpura"></option>
              </datalist>
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="doctor_type"
                >Specialist Type:</label
              >
              <select class="form-select" id="doctor-type" required>
                <option value="" data-translate="select_doctor_type">
                  Select Specialist
                </option>
                <option value="general" data-translate="general_physician">
                  👨‍⚕️ General Physician
                </option>
                <option value="pediatrician" data-translate="pediatrician">
                  👶 Pediatrician
                </option>
                <option value="gynecologist" data-translate="gynecologist">
                  👩‍⚕️ Gynecologist
                </option>
                <option value="cardiologist" data-translate="cardiologist">
                  ❤️ Cardiologist
                </option>
                <option value="orthopedic" data-translate="orthopedic">
                  🦴 Orthopedic
                </option>
                <option value="dermatologist" data-translate="dermatologist">
                  🩺 Dermatologist
                </option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="preferred_date"
                >Preferred Date:</label
              >
              <input
                type="date"
                class="form-input"
                id="preferred-date"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="preferred_time"
                >Preferred Time:</label
              >
              <select class="form-select" id="preferred-time" required>
                <option value="" data-translate="select_time">
                  Select Time Slot
                </option>
                <option value="09:00">🌅 09:00 AM - Morning</option>
                <option value="10:00">🌅 10:00 AM - Morning</option>
                <option value="11:00">🌅 11:00 AM - Morning</option>
                <option value="14:00">☀️ 02:00 PM - Afternoon</option>
                <option value="15:00">☀️ 03:00 PM - Afternoon</option>
                <option value="16:00">☀️ 04:00 PM - Afternoon</option>
                <option value="17:00">🌅 05:00 PM - Evening</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" data-translate="appointment_reason"
                >Reason for Visit:</label
              >
              <textarea
                class="form-textarea"
                id="appointment-reason"
                placeholder="Briefly describe your health concern"
                rows="3"
              ></textarea>
            </div>

            <!-- Added voice recorder section below reason for visit -->
            <div class="form-group">
              <label class="form-label" data-translate="voice_note"
                >Voice Note (Optional):</label
              >
              <div class="voice-recorder-container">
                <div class="voice-controls">
                  <button
                    type="button"
                    id="start-recording"
                    class="btn btn-secondary"
                    onclick="startRecording()"
                  >
                    🎤
                    <span data-translate="start_recording"
                      >Start Recording</span
                    >
                  </button>
                  <button
                    type="button"
                    id="stop-recording"
                    class="btn btn-danger"
                    onclick="stopRecording()"
                    style="display: none"
                  >
                    ⏹️
                    <span data-translate="stop_recording">Stop Recording</span>
                  </button>
                  <button
                    type="button"
                    id="clear-recording"
                    class="btn btn-outline"
                    onclick="clearRecording()"
                    style="display: none"
                  >
                    🗑️ <span data-translate="clear_recording">Clear</span>
                  </button>
                </div>
                <div
                  id="recording-status"
                  class="recording-status"
                  style="display: none"
                >
                  <div class="recording-indicator">
                    <span class="recording-dot"></span>
                    <span data-translate="recording">Recording...</span>
                    <span id="recording-timer">00:00</span>
                  </div>
                </div>
                <div
                  id="recording-preview"
                  class="recording-preview"
                  style="display: none"
                >
                  <div class="preview-header">
                    <span data-translate="recording_preview"
                      >Recording Preview:</span
                    >
                    <span id="recording-duration"></span>
                  </div>
                  <audio
                    id="audio-preview"
                    controls
                    style="width: 100%; margin-top: 0.5rem"
                  ></audio>
                </div>
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-primary btn-block"
              data-translate="book_appointment"
            >
              📅 Book Appointment
            </button>
          </form>

          <div
            id="appointment-confirmation"
            style="display: none"
            class="result-card"
          >
            <h3
              style="color: var(--success)"
              data-translate="appointment_confirmed"
            >
              ✅ Appointment Confirmed!
            </h3>
            <div id="appointment-details"></div>
          </div>
        </div>
      </section>

      <!-- Enhanced Medicine Availability Section -->
      <section id="medicine" class="content-section">
        <div class="section-header">
          <h2 data-translate="medicine_availability">
            💊 Medicine Availability Checker
          </h2>
          <p data-translate="medicine_subtitle">
            Find medicines at nearby pharmacies in real-time
          </p>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label class="form-label" data-translate="search_medicine"
              >Search Medicine:</label
            >
            <div style="display: flex; gap: 1rem">
              <input
                type="text"
                class="form-input"
                id="medicine-search"
                placeholder="Enter medicine name (e.g., Paracetamol)"
                style="flex: 1"
              />
              <button
                class="btn btn-primary"
                onclick="searchMedicine()"
                data-translate="search"
              >
                🔍 Search
              </button>
            </div>
          </div>

          <div id="pharmacy-list">
            <h3
              style="margin: 2rem 0 1rem 0; color: var(--primary-blue)"
              data-translate="nearby_pharmacies"
            >
              Nearby Pharmacies in Nabha Region:
            </h3>

            <div class="card">
              <div class="card-header">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  "
                >
                  <h4 class="card-title">🏪 Sharma Medical Store</h4>
                  <span class="status online">
                    <span class="status-dot"></span>
                    <span data-translate="open">Open</span>
                  </span>
                </div>
              </div>
              <div class="card-body">
                <p>
                  <strong data-translate="location">📍 Location:</strong> Main
                  Market, Nabha, Punjab
                </p>
                <p>
                  <strong data-translate="phone">📞 Phone:</strong>
                  <a href="tel:+919876543210">+91-98765-43210</a>
                </p>
                <p>
                  <strong data-translate="hours">🕒 Hours:</strong> 8:00 AM -
                  9:00 PM
                </p>
                <p>
                  <strong data-translate="common_medicines"
                    >💊 Available Medicines:</strong
                  >
                </p>
                <div
                  style="
                    display: flex;
                    gap: 0.5rem;
                    flex-wrap: wrap;
                    margin-top: 0.5rem;
                  "
                >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Paracetamol</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Crocin</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >ORS</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Antibiotics</span
                  >
                </div>
                <button
                  class="btn btn-secondary"
                  style="margin-top: 1rem"
                  onclick="callPharmacy('919876543210')"
                >
                  📞 Call Now
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  "
                >
                  <h4 class="card-title">🏥 Punjab Medical</h4>
                  <span class="status online">
                    <span class="status-dot"></span>
                    <span data-translate="open">Open</span>
                  </span>
                </div>
              </div>
              <div class="card-body">
                <p>
                  <strong data-translate="location">📍 Location:</strong> Civil
                  Hospital Road, Nabha
                </p>
                <p>
                  <strong data-translate="phone">📞 Phone:</strong>
                  <a href="tel:+919876543211">+91-98765-43211</a>
                </p>
                <p>
                  <strong data-translate="hours">🕒 Hours:</strong> 24/7
                  Available
                </p>
                <p>
                  <strong data-translate="specialty">🎯 Specialty:</strong>
                  Cardiac & Diabetes Medicines
                </p>
                <div
                  style="
                    display: flex;
                    gap: 0.5rem;
                    flex-wrap: wrap;
                    margin-top: 0.5rem;
                  "
                >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Insulin</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >BP Medicines</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Heart Medicines</span
                  >
                </div>
                <button
                  class="btn btn-secondary"
                  style="margin-top: 1rem"
                  onclick="callPharmacy('919876543211')"
                >
                  📞 Call Now
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  "
                >
                  <h4 class="card-title">🇮🇳 Jan Aushadhi Kendra</h4>
                  <span class="status busy">
                    <span class="status-dot"></span>
                    <span data-translate="closing_soon"
                      >Closing Soon (6 PM)</span
                    >
                  </span>
                </div>
              </div>
              <div class="card-body">
                <p>
                  <strong data-translate="location">📍 Location:</strong> Bus
                  Stand, Nabha
                </p>
                <p>
                  <strong data-translate="phone">📞 Phone:</strong>
                  <a href="tel:+919876543212">+91-98765-43212</a>
                </p>
                <p>
                  <strong data-translate="hours">🕒 Hours:</strong> 9:00 AM -
                  6:00 PM
                </p>
                <p>
                  <strong data-translate="specialty">🎯 Specialty:</strong>
                  Generic Medicines at Low Cost
                </p>
                <div
                  style="
                    display: flex;
                    gap: 0.5rem;
                    flex-wrap: wrap;
                    margin-top: 0.5rem;
                  "
                >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Generic Medicines</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Vitamins</span
                  >
                  <span
                    style="
                      background: var(--light-blue);
                      padding: 0.25rem 0.5rem;
                      border-radius: 1rem;
                      font-size: 0.875rem;
                    "
                    >Supplements</span
                  >
                </div>
                <button
                  class="btn btn-secondary"
                  style="margin-top: 1rem"
                  onclick="callPharmacy('919876543212')"
                >
                  📞 Call Now
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Enhanced Health Records Section -->
      <section id="records" class="content-section">
        <div class="section-header">
          <h2 data-translate="health_records">📋 Digital Health Records</h2>
          <p data-translate="records_subtitle">
            Access your complete medical history securely
          </p>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label class="form-label" data-translate="patient_id"
              >Patient ID / Aadhaar Number:</label
            >
            <div style="display: flex; gap: 1rem">
              <input
                type="text"
                class="form-input"
                id="patient-id"
                placeholder="Enter Patient ID or Aadhaar"
                style="flex: 1"
              />
              <button
                class="btn btn-primary"
                onclick="loadHealthRecords()"
                data-translate="load_records"
              >
                🔍 Load Records
              </button>
            </div>
          </div>

          <div id="health-records-list">
            <h3
              style="margin: 2rem 0 1rem 0; color: var(--primary-blue)"
              data-translate="sample_records"
            >
              Sample Medical Records:
            </h3>

            <div class="card">
              <div class="card-header">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  "
                >
                  <h4 class="card-title">📄 Prescription #NH001</h4>
                  <span style="color: var(--text-light); font-size: 0.875rem"
                    >Aug 15, 2025</span
                  >
                </div>
              </div>
              <div class="card-body">
                <p>
                  <strong data-translate="doctor">👨‍⚕️ Doctor:</strong> Dr. Rajesh
                  Sharma (MBBS, MD)
                </p>
                <p>
                  <strong data-translate="diagnosis">🩺 Diagnosis:</strong>
                  <span data-translate="common_cold"
                    >Common Cold with mild fever</span
                  >
                </p>
                <p>
                  <strong data-translate="symptoms">📋 Symptoms:</strong> Fever,
                  Cough, Body ache
                </p>
                <p>
                  <strong data-translate="medicines_prescribed"
                    >💊 Medicines:</strong
                  >
                </p>
                <ul style="margin-left: 1rem; margin-top: 0.5rem">
                  <li>Paracetamol 500mg - 3 times daily for 3 days</li>
                  <li>Cough Syrup - 2 teaspoons twice daily</li>
                  <li>Rest and plenty of fluids</li>
                </ul>
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem">
                  <button
                    class="btn btn-secondary"
                    onclick="viewPrescription('NH001')"
                  >
                    📄 View Full Prescription
                  </button>
                  <button
                    class="btn btn-secondary"
                    onclick="downloadPrescription('NH001')"
                  >
                    ⬇️ Download PDF
                  </button>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  "
                >
                  <h4 class="card-title">🩺 Health Checkup #NH002</h4>
                  <span style="color: var(--text-light); font-size: 0.875rem"
                    >Jul 28, 2025</span
                  >
                </div>
              </div>
              <div class="card-body">
                <p>
                  <strong data-translate="doctor">👩‍⚕️ Doctor:</strong> Dr. Priya
                  Singh (MD, Cardiology)
                </p>
                <p>
                  <strong data-translate="checkup_type">🔍 Type:</strong>
                  <span data-translate="routine_checkup"
                    >Routine Health Checkup</span
                  >
                </p>
                <p>
                  <strong data-translate="vital_signs">❤️ Vital Signs:</strong>
                </p>
                <ul style="margin-left: 1rem; margin-top: 0.5rem">
                  <li>Blood Pressure: 120/80 mmHg (Normal)</li>
                  <li>Heart Rate: 72 BPM (Normal)</li>
                  <li>Temperature: 98.6°F (Normal)</li>
                  <li>Weight: 65 kg, Height: 170 cm</li>
                </ul>
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem">
                  <button
                    class="btn btn-secondary"
                    onclick="viewHealthReport('NH002')"
                  >
                    📊 View Full Report
                  </button>
                  <button
                    class="btn btn-secondary"
                    onclick="shareWithDoctor('NH002')"
                  >
                    👨‍⚕️ Share with Doctor
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Enhanced Video Consultation Section -->
      <section id="video-consult" class="content-section">
        <div class="section-header">
          <h2 data-translate="video_consultation">💻 Video Consultation</h2>
          <p data-translate="video_subtitle">
            Connect with doctors through secure video calls
          </p>
        </div>
        <div class="section-body">
          <div class="video-container" id="video-container">
            <div class="video-placeholder">
              <div style="font-size: 3rem; margin-bottom: 1rem">📹</div>
              <p data-translate="video_placeholder">
                Video consultation will start here
              </p>
              <p
                style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem"
                data-translate="video_requirements"
              >
                Ensure stable internet connection for best experience
              </p>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" data-translate="consultation_id"
              >Consultation ID:</label
            >
            <input
              type="text"
              class="form-input"
              id="consultation-id"
              placeholder="Enter consultation ID from your appointment confirmation"
            />
          </div>

          <div class="video-controls">
            <button
              class="btn btn-success"
              onclick="startVideoCall()"
              data-translate="start_consultation"
            >
              📹 Start Consultation
            </button>
            <button
              class="btn btn-danger"
              onclick="endVideoCall()"
              data-translate="end_consultation"
            >
              ⏹️ End Call
            </button>
            <button
              class="btn btn-secondary"
              onclick="testConnection()"
              data-translate="test_connection"
            >
              🔧 Test Connection
            </button>
          </div>

          <div
            style="
              margin-top: 2rem;
              background: var(--light-blue);
              padding: 1rem;
              border-radius: var(--border-radius);
              border-left: 4px solid var(--info);
            "
          >
            <h4 style="color: var(--info); margin-bottom: 0.5rem">
              ℹ️ Video Call Guidelines
            </h4>
            <ul style="color: var(--text-dark); margin-left: 1rem">
              <li data-translate="guideline_1">
                Ensure good lighting and clear audio
              </li>
              <li data-translate="guideline_2">
                Have your medical history and current medications ready
              </li>
              <li data-translate="guideline_3">
                Test your internet connection before the call
              </li>
              <li data-translate="guideline_4">
                Keep your consultation ID handy
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Enhanced Emergency Section -->
      <section id="emergency" class="content-section">
        <div class="section-header">
          <h2 data-translate="emergency_services">🚨 Emergency Services</h2>
          <p data-translate="emergency_subtitle">
            Immediate access to emergency healthcare services
          </p>
        </div>
        <div class="section-body">
          <div class="emergency-grid">
            <div class="emergency-card" onclick="callEmergency('102')">
              <div class="emergency-icon">🚑</div>
              <div class="emergency-title" data-translate="ambulance">
                Ambulance
              </div>
              <div class="emergency-number">102</div>
            </div>

            <div class="emergency-card" onclick="callEmergency('100')">
              <div class="emergency-icon">👮</div>
              <div class="emergency-title" data-translate="police">Police</div>
              <div class="emergency-number">100</div>
            </div>

            <div class="emergency-card" onclick="callEmergency('101')">
              <div class="emergency-icon">🔥</div>
              <div class="emergency-title" data-translate="fire_brigade">
                Fire Brigade
              </div>
              <div class="emergency-number">101</div>
            </div>

            <div class="emergency-card" onclick="callEmergency('1091')">
              <div class="emergency-icon">👩</div>
              <div class="emergency-title" data-translate="women_helpline">
                Women Helpline
              </div>
              <div class="emergency-number">1091</div>
            </div>
          </div>

          <div class="card" style="margin: 2rem 0">
            <div class="card-header">
              <h4 class="card-title">
                🏥 Nabha Civil Hospital - Emergency Department
              </h4>
            </div>
            <div class="card-body">
              <p>
                <strong data-translate="address">📍 Address:</strong> Civil
                Hospital Road, Nabha, Punjab 147201
              </p>
              <p>
                <strong data-translate="emergency_phone">📞 Emergency:</strong>
                <a href="tel:+91-1765-222100">+91-1765-222100</a>
              </p>
              <p>
                <strong data-translate="availability">⏰ Availability:</strong>
                24/7 Emergency Services
              </p>
              <p>
                <strong data-translate="facilities">🏥 Facilities:</strong> ICU,
                Emergency Room, Ambulance Service
              </p>
              <div
                style="
                  margin-top: 1rem;
                  display: flex;
                  gap: 0.5rem;
                  flex-wrap: wrap;
                "
              >
                <button
                  class="btn btn-danger"
                  onclick="callEmergency('1765222100')"
                >
                  📞 Call Hospital
                </button>
                <button class="btn btn-secondary" onclick="getDirections()">
                  🗺️ Get Directions
                </button>
              </div>
            </div>
          </div>

          <button
            class="btn btn-danger btn-block"
            onclick="emergencyAlert()"
            style="font-size: 1.1rem; padding: 1rem"
          >
            🚨 SEND EMERGENCY ALERT WITH LOCATION
          </button>

          <div
            style="
              margin-top: 2rem;
              background: #fff3cd;
              padding: 1rem;
              border-radius: var(--border-radius);
              border-left: 4px solid var(--warning);
            "
          >
            <h4 style="color: #856404; margin-bottom: 0.5rem">
              ⚠️ Emergency Preparedness Tips
            </h4>
            <ul style="color: #856404; margin-left: 1rem">
              <li data-translate="tip_1">
                Keep emergency contact numbers saved in your phone
              </li>
              <li data-translate="tip_2">
                Maintain a basic first aid kit at home
              </li>
              <li data-translate="tip_3">Know the route to nearest hospital</li>
              <li data-translate="tip_4">
                Keep important medical documents ready
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <!-- Added advanced chatbot widget -->
    <div id="chatbot-widget" class="chatbot-widget">
      <div class="chatbot-header" onclick="toggleChatbot()">
        <div class="chatbot-avatar">🤖</div>
        <div class="chatbot-title">
          <span data-translate="health_assistant">Health Assistant</span>
          <div class="chatbot-status">
            <span class="status-dot online"></span>
            <span data-translate="online">Online</span>
          </div>
        </div>
        <button class="chatbot-toggle" id="chatbot-toggle-btn">
          <span id="chatbot-icon">💬</span>
        </button>
      </div>

      <div
        id="chatbot-container"
        class="chatbot-container"
        style="display: none"
      >
        <div class="chatbot-messages" id="chatbot-messages">
          <div class="message bot-message">
            <div class="message-avatar">🤖</div>
            <div class="message-content">
              <span data-translate="chatbot_welcome"
                >Hello! I'm your health assistant. I can help you with symptoms,
                appointment booking, medicine information, and emergency
                guidance. How can I assist you today?</span
              >
            </div>
          </div>
        </div>

        <div class="chatbot-input-container">
          <div class="chatbot-suggestions" id="chatbot-suggestions">
            <button
              class="suggestion-btn"
              onclick="sendSuggestion('symptoms')"
              data-translate="check_symptoms"
            >
              Check Symptoms
            </button>
            <button
              class="suggestion-btn"
              onclick="sendSuggestion('appointment')"
              data-translate="book_appointment"
            >
              Book Appointment
            </button>
            <button
              class="suggestion-btn"
              onclick="sendSuggestion('medicine')"
              data-translate="find_medicine"
            >
              Find Medicine
            </button>
            <button
              class="suggestion-btn"
              onclick="sendSuggestion('emergency')"
              data-translate="emergency_help"
            >
              Emergency Help
            </button>
          </div>

          <div class="chatbot-input-area">
            <input
              type="text"
              id="chatbot-input"
              class="chatbot-input"
              placeholder="Type your message..."
              onkeypress="handleChatbotKeypress(event)"
            />
            <button
              class="chatbot-voice-btn"
              onclick="startChatbotVoice()"
              title="Voice input"
            >
              🎤
            </button>
            <button class="chatbot-send-btn" onclick="sendChatbotMessage()">
              ➤
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Footer -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3 data-translate="about_nabha_health">About Nabha HealthConnect</h3>
          <p data-translate="footer_description">
            Bridging the healthcare gap in rural Punjab through accessible
            telemedicine technology. Serving 173 villages with quality medical
            care.
          </p>
        </div>

        <div class="footer-section">
          <h3 data-translate="contact_info">Contact Information</h3>
          <p>📍 Nabha, Punjab, India</p>
          <p>📞 +91-1765-222100</p>
          <p>✉️ support@nabha-health.gov.in</p>
          <p>🌐 www.nabha-healthconnect.gov.in</p>
        </div>

        <div class="footer-section">
          <h3 data-translate="quick_links">Quick Links</h3>
          <p>
            <a href="#symptom-checker" data-translate="symptom_checker"
              >Symptom Checker</a
            >
          </p>
          <p>
            <a href="#appointments" data-translate="book_appointment"
              >Book Appointment</a
            >
          </p>
          <p>
            <a href="#emergency" data-translate="emergency_services"
              >Emergency Services</a
            >
          </p>
          <p><a href="#" data-translate="privacy_policy">Privacy Policy</a></p>
        </div>

        <div class="footer-section">
          <h3 data-translate="supported_by">Supported By</h3>
          <p>🏛️ Government of Punjab</p>
          <p>🏥 Ministry of Health</p>
          <p>💻 Digital India Initiative</p>
          <p>🌍 WHO Telemedicine Standards</p>
        </div>
      </div>

      <div class="footer-bottom">
        <p>
          &copy; 2025 Nabha HealthConnect. Made with ❤️ for rural healthcare
          accessibility.
        </p>
      </div>
    </footer>

    <!-- Enhanced JavaScript with Backend Integration -->
    <script>
      // Enhanced Translation System
      const translations = {
        en: {
          app_title: "Nabha HealthConnect",
          app_subtitle: "Rural Telemedicine Platform",
          offline:
            "⚠️ You are currently offline. Some features may be limited.",
          hero_title: "Connecting 173 Villages with Quality Healthcare",
          hero_subtitle:
            "Access doctors, book appointments, and get medical assistance from your smartphone - even offline",
          villages_served: "Villages Served",
          emergency_support: "Emergency Support",
          languages_supported: "Languages",
          offline_capable: "Offline Capable",
          services_title: "Healthcare Services",
          symptom_checker: "AI Symptom Checker",
          symptom_checker_desc:
            "Get preliminary diagnosis based on your symptoms",
          appointments: "Book Appointment",
          appointments_desc: "Schedule consultation with specialists",
          medicine: "Medicine Finder",
          medicine_desc: "Check availability at nearby pharmacies",
          health_records: "Health Records",
          health_records_desc: "Access your digital medical history",
          video_consult: "Video Consultation",
          video_consult_desc: "Connect with doctors via video call",
          emergency: "Emergency",
          emergency_desc: "Quick access to emergency services",

          // Symptom Checker
          symptom_checker_title: "🔍 AI-Powered Symptom Checker",
          symptom_checker_subtitle:
            "Select your symptoms below for preliminary medical guidance",
          select_symptoms: "Select Your Symptoms:",
          fever: "Fever",
          cough: "Cough",
          headache: "Headache",
          stomach_pain: "Stomach Pain",
          body_ache: "Body Ache",
          breathing_difficulty: "Breathing Issues",
          dizziness: "Dizziness",
          fatigue: "Fatigue",
          analyze_symptoms: "🔬 Analyze Symptoms",
          analysis_results: "Analysis Results:",

          // Appointments
          book_appointment: "📅 Book Medical Appointment",
          appointment_subtitle:
            "Schedule a consultation with our experienced doctors",
          patient_name: "Patient Name:",
          phone_number: "Phone Number:",
          consultant_id: "Consultant ID (if available):",
          no_consultant_id: "I don't have one",
          village_name: "Village Name:",
          doctor_type: "Specialist Type:",
          select_doctor_type: "Select Specialist",
          general_physician: "👨‍⚕️ General Physician",
          pediatrician: "👶 Pediatrician",
          gynecologist: "👩‍⚕️ Gynecologist",
          cardiologist: "❤️ Cardiologist",
          orthopedic: "🦴 Orthopedic",
          dermatologist: "🩺 Dermatologist",
          preferred_date: "Preferred Date:",
          preferred_time: "Preferred Time:",
          select_time: "Select Time Slot",
          appointment_reason: "Reason for Visit:",
          voice_note: "Voice Note (Optional):",
          start_recording: "Start Recording",
          stop_recording: "Stop Recording",
          clear_recording: "Clear",
          recording: "Recording...",
          recording_preview: "Recording Preview:",
          appointment_confirmed: "✅ Appointment Confirmed!",

          // Medicine
          medicine_availability: "💊 Medicine Availability Checker",
          medicine_subtitle: "Find medicines at nearby pharmacies in real-time",
          search_medicine: "Search Medicine:",
          search: "🔍 Search",
          nearby_pharmacies: "Nearby Pharmacies in Nabha Region:",
          location: "📍 Location:",
          phone: "📞 Phone:",
          hours: "🕒 Hours:",
          specialty: "🎯 Specialty:",
          open: "Open",
          closing_soon: "Closing Soon (6 PM)",
          common_medicines: "💊 Available Medicines:",

          // Health Records
          health_records: "📋 Digital Health Records",
          records_subtitle: "Access your complete medical history securely",
          patient_id: "Patient ID / Aadhaar Number:",
          load_records: "🔍 Load Records",
          sample_records: "Sample Medical Records:",
          doctor: "👨‍⚕️ Doctor:",
          diagnosis: "🩺 Diagnosis:",
          symptoms: "📋 Symptoms:",
          medicines_prescribed: "💊 Medicines:",
          checkup_type: "🔍 Type:",
          routine_checkup: "Routine Health Checkup",
          vital_signs: "❤️ Vital Signs:",

          // Video Consultation
          video_consultation: "💻 Video Consultation",
          video_subtitle: "Connect with doctors through secure video calls",
          video_placeholder: "Video consultation will start here",
          video_requirements:
            "Ensure stable internet connection for best experience",
          consultation_id: "Consultation ID:",
          start_consultation: "📹 Start Consultation",
          end_consultation: "⏹️ End Call",
          test_connection: "🔧 Test Connection",
          guideline_1: "Ensure good lighting and clear audio",
          guideline_2:
            "Have your medical history and current medications ready",
          guideline_3: "Test your internet connection before the call",
          guideline_4: "Keep your consultation ID handy",

          // Emergency
          emergency_services: "🚨 Emergency Services",
          emergency_subtitle:
            "Immediate access to emergency healthcare services",
          ambulance: "Ambulance",
          police: "Police",
          fire_brigade: "Fire Brigade",
          women_helpline: "Women Helpline",
          address: "📍 Address:",
          emergency_phone: "📞 Emergency:",
          availability: "⏰ Availability:",
          facilities: "🏥 Facilities:",
          tip_1: "Keep emergency contact numbers saved in your phone",
          tip_2: "Maintain a basic first aid kit at home",
          tip_3: "Know the route to nearest hospital",
          tip_4: "Keep important medical documents ready",

          // Footer
          about_nabha_health: "About Nabha HealthConnect",
          footer_description:
            "Bridging the healthcare gap in rural Punjab through accessible telemedicine technology. Serving 173 villages with quality medical care.",
          contact_info: "Contact Information",
          quick_links: "Quick Links",
          supported_by: "Supported By",
          privacy_policy: "Privacy Policy",

          // Chatbot
          health_assistant: "Health Assistant",
          chatbot_welcome:
            "Hello! I'm your health assistant. I can help you with symptoms, appointment booking, medicine information, and emergency guidance. How can I assist you today?",
          check_symptoms: "Check Symptoms",
          find_medicine: "Find Medicine",
          emergency_help: "Emergency Help",
          online: "Online",
        },
        hi: {
          app_title: "नाभा हेल्थकनेक्ट",
          app_subtitle: "ग्रामीण टेलीमेडिसिन प्लेटफॉर्म",
          offline:
            "⚠️ आप वर्तमान में ऑफलाइन हैं। कुछ सुविधाएँ सीमित हो सकती हैं।",
          hero_title: "173 गाँवों को गुणवत्तापूर्ण स्वास्थ्य सेवा से जोड़ना",
          hero_subtitle:
            "डॉक्टरों तक पहुंचें, अपॉइंटमेंट बुक करें और अपने स्मार्टफोन से - यहां तक कि ऑफलाइन भी - चिकित्सकीय सहायता प्राप्त करें",
          villages_served: "सेवा प्रदान गाँव",
          emergency_support: "आपातकालीन सहायता",
          languages_supported: "भाषाएँ",
          offline_capable: "ऑफलाइन सक्षम",
          services_title: "स्वास्थ्य सेवाएँ",
          symptom_checker: "एआई लक्षण जांचकर्ता",
          symptom_checker_desc:
            "अपने लक्षणों के आधार पर प्रारंभिक निदान प्राप्त करें",
          appointments: "अपॉइंटमेंट बुक करें",
          appointments_desc: "विशेषज्ञों के साथ परामर्श शेड्यूल करें",
          medicine: "दवा खोजक",
          medicine_desc: "निकटतम फार्मेसियों पर उपलब्धता जांचें",
          health_records: "स्वास्थ्य रिकॉर्ड",
          health_records_desc: "अपने डिजिटल मेडिकल इतिहास तक पहुंचें",
          video_consult: "वीडियो परामर्श",
          video_consult_desc: "वीडियो कॉल के माध्यम से डॉक्टरों से जुड़ें",
          emergency: "आपातकाल",
          emergency_desc: "आपातकालीन सेवाओं तक त्वरित पहुंच",

          symptom_checker_title: "🔍 एआई-संचालित लक्षण जांचकर्ता",
          symptom_checker_subtitle:
            "प्रारंभिक चिकित्सा मार्गदर्शन के लिए अपने लक्षणों का चयन करें",
          select_symptoms: "अपने लक्षण चुनें:",
          fever: "बुखार",
          cough: "खांसी",
          headache: "सिरदर्द",
          stomach_pain: "पेट दर्द",
          body_ache: "शरीर में दर्द",
          breathing_difficulty: "सांस लेने में तकलीफ",
          dizziness: "चक्कर आना",
          fatigue: "थकान",
          analyze_symptoms: "🔬 लक्षणों का विश्लेषण करें",
          analysis_results: "विश्लेषण परिणाम:",

          book_appointment: "📅 चिकित्सकीय अपॉइंटमेंट बुक करें",
          appointment_subtitle:
            "हमारे अनुभवी डॉक्टरों के साथ परामर्श शेड्यूल करें",
          patient_name: "मरीज का नाम:",
          phone_number: "फोन नंबर:",
          consultant_id: "सलाहकार आईडी (यदि उपलब्ध हो):",
          no_consultant_id: "मेरे पास नहीं है",
          village_name: "गाँव का नाम:",
          doctor_type: "विशेषज्ञ प्रकार:",
          select_doctor_type: "विशेषज्ञ चुनें",
          general_physician: "👨‍⚕️ सामान्य चिकित्सक",
          pediatrician: "👶 बाल रोग विशेषज्ञ",
          gynecologist: "👩‍⚕️ स्त्री रोग विशेषज्ञ",
          cardiologist: "❤️ हृदय रोग विशेषज्ञ",
          orthopedic: "🦴 ऑर्थोपेडिक",
          dermatologist: "🩺 त्वचा विशेषज्ञ",
          preferred_date: "पसंदीदा तारीख:",
          preferred_time: "पसंदीदा समय:",
          select_time: "समय स्लॉट चुनें",
          appointment_reason: "विजिट का कारण:",
          voice_note: "वॉइस नोट (वैकल्पिक):",
          start_recording: "रिकॉर्डिंग शुरू करें",
          stop_recording: "रिकॉर्डिंग रोकें",
          clear_recording: "साफ़ करें",
          recording: "रिकॉर्डिंग...",
          recording_preview: "रिकॉर्डिंग पूर्वावलोकन:",
          appointment_confirmed: "✅ अपॉइंटमेंट की पुष्टि हुई!",

          medicine_availability: "💊 दवा उपलब्धता जांचकर्ता",
          medicine_subtitle:
            "आस-पास की फार्मेसियों में दवाएं रीयल-टाइम में खोजें",
          search_medicine: "दवा खोजें:",
          search: "🔍 खोजें",
          nearby_pharmacies: "नाभा क्षेत्र में निकटतम फार्मेसियाँ:",
          location: "📍 स्थान:",
          phone: "📞 फोन:",
          hours: "🕒 घंटे:",
          specialty: "🎯 विशेषता:",
          open: "खुला",
          closing_soon: "जल्द बंद होगा (शाम 6 बजे)",
          common_medicines: "💊 उपलब्ध दवाएं:",

          health_records: "📋 डिजिटल स्वास्थ्य रिकॉर्ड",
          records_subtitle:
            "अपना पूरा मेडिकल इतिहास सुरक्षित रूप से एक्सेस करें",
          patient_id: "मरीज आईडी / आधार नंबर:",
          load_records: "🔍 रिकॉर्ड लोड करें",
          sample_records: "नमूना चिकित्सा रिकॉर्ड:",
          doctor: "👨‍⚕️ डॉक्टर:",
          diagnosis: "🩺 निदान:",
          symptoms: "📋 लक्षण:",
          medicines_prescribed: "💊 दवाएं:",
          checkup_type: "🔍 प्रकार:",
          routine_checkup: "नियमित स्वास्थ्य जांच",
          vital_signs: "❤️ महत्वपूर्ण संकेत:",

          video_consultation: "💻 वीडियो परामर्श",
          video_subtitle: "सुरक्षित वीडियो कॉल के माध्यम से डॉक्टरों से जुड़ें",
          video_placeholder: "वीडियो परामर्श यहां शुरू होगा",
          video_requirements:
            "सर्वोत्तम अनुभव के लिए स्थिर इंटरनेट कनेक्शन सुनिश्चित करें",
          consultation_id: "परामर्श आईडी:",
          start_consultation: "📹 परामर्श शुरू करें",
          end_consultation: "⏹️ कॉल समाप्त करें",
          test_connection: "🔧 कनेक्शन परीक्षण",
          guideline_1: "अच्छी रोशनी और स्पष्ट ऑडियो सुनिश्चित करें",
          guideline_2: "अपना मेडिकल इतिहास और वर्तमान दवाएं तैयार रखें",
          guideline_3: "कॉल से पहले अपने इंटरनेट कनेक्शन का परीक्षण करें",
          guideline_4: "अपनी परामर्श आईडी हाथ में रखें",

          emergency_services: "🚨 आपातकालीन सेवाएं",
          emergency_subtitle: "आपातकालीन स्वास्थ्य सेवाओं तक तत्काल पहुंच",
          ambulance: "एम्बुलेंस",
          police: "पुलिस",
          fire_brigade: "फायर ब्रिगेड",
          women_helpline: "महिला हेल्पलाइन",
          address: "📍 पता:",
          emergency_phone: "📞 आपातकाल:",
          availability: "⏰ उपलब्धता:",
          facilities: "🏥 सुविधाएं:",
          tip_1: "आपातकालीन संपर्क नंबर अपने फोन में सेव रखें",
          tip_2: "घर पर एक बुनियादी फर्स्ट एड किट रखें",
          tip_3: "निकटतम अस्पताल का रास्ता जानें",
          tip_4: "महत्वपूर्ण चिकित्सा दस्तावेज तैयार रखें",

          about_nabha_health: "नाभा हेल्थकनेक्ट के बारे में",
          footer_description:
            "सुलभ टेलीमेडिसिन प्रौद्योगिकी के माध्यम से ग्रामीण पंजाब में स्वास्थ्य सेवा के अंतर को पाटना। 173 गाँवों को गुणवत्तापूर्ण चिकित्सा देखभाल प्रदान करना।",
          contact_info: "संपर्क जानकारी",
          quick_links: "त्वरित लिंक",
          supported_by: "द्वारा समर्थित",
          privacy_policy: "गोपनीयता नीति",

          health_assistant: "स्वास्थ्य सहायक",
          chatbot_welcome:
            "नमस्ते! मैं आपकी स्वास्थ्य सहायक हूं। मैं आपको लक्षणों, अपॉइंटमेंट बुकिंग, दवा की जानकारी और आपातकालीन मार्गदर्शन में मदद कर सकती हूं। मैं आज आपकी कैसे सहायता कर सकती हूं?",
          check_symptoms: "लक्षण जांचें",
          find_medicine: "दवा खोजें",
          emergency_help: "आपातकालीन सहायता",
          online: "ऑनलाइन",
        },
        pa: {
          app_title: "ਨਭਾ ਹੈਲਥਕਨੈਕਟ",
          app_subtitle: "ਪੇਂਡੂ ਟੈਲੀਮੈਡੀਸਨ ਪਲੇਟਫਾਰਮ",
          offline:
            "⚠️ ਤੁਸੀਂ ਇਸ ਸਮੇਂ ਆਫਲਾਈਨ ਹੋ। ਕੁਝ ਵਿਸ਼ੇਸ਼ਤਾਵਾਂ ਸੀਮਿਤ ਹੋ ਸਕਦੀਆਂ ਹਨ।",
          hero_title: "173 ਪਿੰਡਾਂ ਨੂੰ ਗੁਣਵੱਤਾ ਪੂਰਣ ਸਿਹਤ ਸੇਵਾ ਨਾਲ ਜੋੜਨਾ",
          hero_subtitle:
            "ਆਪਣੇ ਸਮਾਰਟਫੋਨ ਤੋਂ ਹੀ ਡਾਕਟਰਾਂ ਤੱਕ ਪਹੁੰਚ ਕਰੋ, ਅਪਾਇੰਟਮੈਂਟ ਬੁੱਕ ਕਰੋ ਅਤੇ ਮੈਡੀਕਲ ਸਹਾਇਤਾ ਪ੍ਰਾਪਤ ਕਰੋ - ਆਫਲਾਈਨ ਵੀ",
          villages_served: "ਪਿੰਡ ਸੇਵਾ ਪ੍ਰਦਾਨ ਕਰਦੇ ਹਨ",
          emergency_support: "ਐਮਰਜੈਂਸੀ ਸਹਾਇਤਾ",
          languages_supported: "ਭਾਸ਼ਾਵਾਂ",
          offline_capable: "ਆਫਲਾਈਨ ਸਮਰੱਥ",
          services_title: "ਸਿਹਤ ਸੇਵਾਵਾਂ",
          symptom_checker: "ਏਆਈ ਲੱਛਣ ਚੈਕਰ",
          symptom_checker_desc:
            "ਆਪਣੇ ਲੱਛਣਾਂ ਦੇ ਆਧਾਰ 'ਤੇ ਸ਼ੁਰੂਆਤੀ ਨਿਦਾਨ ਪ੍ਰਾਪਤ ਕਰੋ",
          appointments: "ਅਪਾਇੰਟਮੈਂਟ ਬੁੱਕ ਕਰੋ",
          appointments_desc: "ਮਾਹਿਰਾਂ ਨਾਲ ਸਲਾਹ-ਮਸ਼ਵਰਾ ਨਿਯਤ ਕਰੋ",
          medicine: "ਦਵਾਈ ਖੋਜਕ",
          medicine_desc: "ਨਜ਼ਦੀਕੀ ਫਾਰਮੇਸੀਆਂ 'ਤੇ ਉਪਲਬਧਤਾ ਦੀ ਜਾਂਚ ਕਰੋ",
          health_records: "ਸਿਹਤ ਰਿਕਾਰਡ",
          health_records_desc: "ਆਪਣੇ ਡਿਜੀਟਲ ਮੈਡੀਕਲ ਇਤਿਹਾਸ ਤੱਕ ਪਹੁੰਚ ਕਰੋ",
          video_consult: "ਵੀਡੀਓ ਸਲਾਹ",
          video_consult_desc: "ਵੀਡੀਓ ਕਾਲ ਦੁਆਰਾ ਡਾਕਟਰਾਂ ਨਾਲ ਜੁੜੋ",
          emergency: "ਐਮਰਜੈਂਸੀ",
          emergency_desc: "ਐਮਰਜੈਂਸੀ ਸੇਵਾਵਾਂ ਤੇਜ਼ੀ ਨਾਲ ਪਹੁੰਚ",

          // Symptom Checker
          symptom_checker_title: "🔍 ਏਆਈ-ਸੰਚਾਲਿਤ ਲੱਛਣ ਚੈਕਰ",
          symptom_checker_subtitle:
            "ਸ਼ੁਰੂਆਤੀ ਮੈਡੀਕਲ ਮਾਰਗਦਰਸ਼ਨ ਲਈ ਆਪਣੇ ਲੱਛਣ ਚੁਣੋ",
          select_symptoms: "ਆਪਣੇ ਲੱਛਣ ਚੁਣੋ:",
          fever: "ਬੁਖਾਰ",
          cough: "ਖਾਂਸੀ",
          headache: "ਸਿਰ ਦਰਦ",
          stomach_pain: "ਪੇਟ ਦਰਦ",
          body_ache: "ਸਰੀਰ ਦਰਦ",
          breathing_difficulty: "ਸਾਹ ਲੈਣ 'ਚ ਤਕਲੀਫ",
          dizziness: "ਚਕਕਰ ਆਉਣਾ",
          fatigue: "ਥਕਾਵਟ",
          analyze_symptoms: "🔬 ਲੱਛਣਾਂ ਦਾ ਵਿਸ਼ਲੇਸ਼ਣ ਕਰੋ",
          analysis_results: "ਵਿਸ਼ਲੇਸ਼ਣ ਦੇ ਨਤੀਜੇ:",

          // Appointments
          book_appointment: "📅 ਮੈਡੀਕਲ ਅਪਾਇੰਟਮੈਂਟ ਬੁੱਕ ਕਰੋ",
          appointment_subtitle: "ਸਾਡੇ ਅਨੁਭਵੀ ਡਾਕਟਰਾਂ ਨਾਲ ਸਲਾਹ-ਮਸ਼ਵਰਾ ਨਿਯਤ ਕਰੋ",
          patient_name: "ਮਰੀਜ਼ ਦਾ ਨਾਮ:",
          phone_number: "ਫੋਨ ਨੰਬਰ:",
          consultant_id: "ਸਲਾਹਕਾਰ ਆਈਡੀ (ਜੇ ਉਪਲਬਧ ਹੋ):",
          no_consultant_id: "ਮੇਰੇ ਕੋਲ ਨਹੀਂ ਹੈ",
          village_name: "ਪਿੰਡ ਦਾ ਨਾਮ:",
          doctor_type: "ਮਾਹਿਰ ਦੀ ਕਿਸਮ:",
          select_doctor_type: "ਮਾਹਿਰ ਚੁਣੋ",
          general_physician: "👨‍⚕️ ਜਨਰਲ ਫਿਜ਼ੀਸ਼ੀਅਨ",
          pediatrician: "👶 ਬਾਲ ਰੋਗ ਵਿਸ਼ੇਸ਼ਜ਼",
          gynecologist: "👩‍⚕️ ਗਾਇਨੀਕੋਲੋਜਿਸਟ",
          cardiologist: "❤️ ਕਾਰਡੀਓਲੋਜਿਸਟ",
          orthopedic: "🦴 ਆਰਥੋਪੇਡਿਕ",
          dermatologist: "🩺 ਚਮੜੀ ਰੋਗ ਵਿਸ਼ੇਸ਼ਜ਼",
          preferred_date: "ਤਰਜੀਹੀ ਤਾਰੀਖ:",
          preferred_time: "ਤਰਜੀਹੀ ਸਮਾਂ:",
          select_time: "ਸਮਾਂ ਸਲਾਟ ਚੁਣੋ",
          appointment_reason: "ਆਉਣ ਦਾ ਕਾਰਨ:",
          voice_note: "ਵੌਇਸ ਨੋਟ (ਵਿਕਲਪਿਕ):",
          start_recording: "ਰਿਕਾਰਡਿੰਗ ਸ਼ੁਰੂ ਕਰੋ",
          stop_recording: "ਰਿਕਾਰਡਿੰਗ ਰੋਕੋ",
          clear_recording: "ਸਾਫ਼ ਕਰੋ",
          recording: "ਰਿਕਾਰਡ ਕੀਤਾ ਜਾ ਰਿਹਾ ਹੈ...",
          recording_preview: "ਰਿਕਾਰਡਿੰਗ ਪੂਰਵਦਰਸ਼ਨ:",
          appointment_confirmed: "✅ ਅਪਾਇੰਟਮੈਂਟ ਪੁਸ਼ਟੀ ਹੋਈ!",

          // Medicine
          medicine_availability: "💊 ਦਵਾਈ ਉਪਲਬਧਤਾ ਚੈਕਰ",
          medicine_subtitle: "ਰੀਅਲ-ਟਾਈਮ ਵਿੱਚ ਨਜ਼ਦੀਕੀ ਫਾਰਮੇਸੀਆਂ 'ਤੇ ਦਵਾਈਆਂ ਲੱਭੋ",
          search_medicine: "ਦਵਾਈ ਖੋਜੋ:",
          search: "🔍 ਖੋਜੋ",
          nearby_pharmacies: "ਨਭਾ ਖੇਤਰ ਵਿੱਚ ਨਜ਼ਦੀਕੀ ਫਾਰਮੇਸੀਆਂ:",
          location: "📍 ਟਿਕਾਣਾ:",
          phone: "📞 ਫੋਨ:",
          hours: "🕒 ਸਮਾਂ:",
          specialty: "🎯 ਵਿਸ਼ੇਸ਼ਤਾ:",
          open: "ਖੁੱਲ੍ਹਾ ਹੈ",
          closing_soon: "ਛੇਤੀ ਬੰਦ ਹੋਵੇਗਾ (ਸ਼ਾਮ 6 ਬਜੇ)",
          common_medicines: "💊 ਉਪਲਬਧ ਦਵਾਈਆਂ:",

          // Health Records
          health_records: "📋 ਡਿਜੀਟਲ ਸਿਹਤ ਰਿਕਾਰਡ",
          records_subtitle:
            "ਆਪਣਾ ਪੂਰਾ ਮੈਡੀਕਲ ਇਤਿਹਾਸ ਸੁਰੱਖਿਅਤ ਢੰਗ ਨਾਲ ਪ੍ਰਾਪਤ ਕਰੋ",
          patient_id: "ਮਰੀਜ਼ ਆਈਡੀ / ਆਧਾਰ ਨੰਬਰ:",
          load_records: "🔍 ਰਿਕਾਰਡ ਲੋਡ ਕਰੋ",
          sample_records: "ਨਮੂਨਾ ਮੈਡੀਕਲ ਰਿਕਾਰਡ:",
          doctor: "👨‍⚕️ ਡਾਕਟਰ:",
          diagnosis: "🩺 ਨਿਦਾਨ:",
          symptoms: "📋 ਲੱਛਣ:",
          medicines_prescribed: "💊 ਦਵਾਈਆਂ:",
          checkup_type: "🔍 ਕਿਸਮ:",
          routine_checkup: "ਰੁਟੀਨ ਸਿਹਤ ਜਾਂਚ",
          vital_signs: "❤️ ਮਹੱਤਵਪੂਰਨ ਸੰਕੇਤ:",

          // Video Consultation
          video_consultation: "💻 ਵੀਡੀਓ ਸਲਾਹ",
          video_subtitle: "ਸੁਰੱਖਿਅਤ ਵੀਡੀਓ ਕਾਲਾਂ ਦੁਆਰਾ ਡਾਕਟਰਾਂ ਨਾਲ ਜੁੜੋ",
          video_placeholder: "ਵੀਡੀਓ ਸਲਾਹ ਇੱਥੇ ਸ਼ੁਰੂ ਹੋਵੇਗੀ",
          video_requirements:
            "ਬੇਹਤਰੀਨ ਅਨੁਭਵ ਲਈ ਸਥਿਰ ਇੰਟਰਨੈਟ ਕਨੈਕਸ਼ਨ ਸੁਨਿਸ਼ਚਿਤ ਕਰੋ",
          consultation_id: "ਸਲਾਹ ਆਈਡੀ:",
          start_consultation: "📹 ਸਲਾਹ ਸ਼ੁਰੂ ਕਰੋ",
          end_consultation: "⏹️ ਕਾਲ ਬੰਦ ਕਰੋ",
          test_connection: "🔧 ਕਨੈਕਸ਼ਨ ਟੈਸਟ ਕਰੋ",
          guideline_1: "ਚੰਗੀ ਰੋਸ਼ਨੀ ਅਤੇ ਸਾਫ਼ ਆਡੀਓ ਸੁਨਿਸ਼ਚਿਤ ਕਰੋ",
          guideline_2: "ਆਪਣਾ ਮੈਡੀਕਲ ਇਤਿਹਾਸ ਅਤੇ ਮੌਜੂਦਾ ਦਵਾਈਆਂ ਤਿਆਰ ਰੱਖੋ",
          guideline_3: "ਕਾਲ ਤੋਂ ਪਹਿਲਾਂ ਆਪਣਾ ਇੰਟਰਨੈਟ ਕਨੈਕਸ਼ਨ ਟੈਸਟ ਕਰੋ",
          guideline_4: "ਆਪਣੀ ਸਲਾਹ ਆਈਡੀ ਹੱਥੋ-ਹੱਥ ਰੱਖੋ",

          // Emergency
          emergency_services: "🚨 ਐਮਰਜੈਂਸੀ ਸੇਵਾਵਾਂ",
          emergency_subtitle: "ਐਮਰਜੈਂਸੀ ਸਿਹਤ ਸੇਵਾਵਾਂ ਤੱਕ ਤੁਰੰਤ ਪਹੁੰਚ",
          ambulance: "ਐਮਬੂਲੈਂਸ",
          police: "ਪੁਲਿਸ",
          fire_brigade: "ਫਾਇਰ ਬ੍ਰਿਗੇਡ",
          women_helpline: "ਮਹਿਲਾ ਹੈਲਪਲਾਈਨ",
          address: "📍 ਪਤਾ:",
          emergency_phone: "📞 ਐਮਰਜੈਂਸੀ:",
          availability: "⏰ ਉਪਲਬਧਤਾ:",
          facilities: "🏥 ਸੁਵਿਧਾਵਾਂ:",
          tip_1: "ਐਮਰਜੈਂਸੀ ਸੰਪਰਕ ਨੰਬਰ ਆਪਣੇ ਫੋਨ ਵਿੱਚ ਸੰਭਾਲ ਕੇ ਰੱਖੋ",
          tip_2: "ਘਰ 'ਤੇ ਇੱਕ ਬੁਨਿਆਦੀ ਫਸਟ ਐਡ ਕਿੱਟ ਰੱਖੋ",
          tip_3: "ਨਜ਼ਦੀਕੀ ਹਸਪਤਾਲ ਦਾ ਰਸਤਾ ਜਾਣੋ",
          tip_4: "ਮਹੱਤਵਪੂਰਨ ਮੈਡੀਕਲ ਦਸਤਾਵੇਜ਼ ਤਿਆਰ ਰੱਖੋ",

          // Footer
          about_nabha_health: "ਨਭਾ ਹੈਲਥਕਨੈਕਟ ਬਾਰੇ",
          footer_description:
            "ਪਹੁੰਚਯੋਗ ਟੈਲੀਮੈਡੀਸਨ ਟੈਕਨਾਲੋਜੀ ਦੁਆਰਾ ਪੇਂਡੂ ਪੰਜਾਬ ਵਿੱਚ ਸਿਹਤ ਦੇ ਫਾਸਲੇ ਨੂੰ ਪਾੜਨਾ। 173 ਪਿੰਡਾਂ ਨੂੰ ਗੁਣਵੱਤਾ ਪੂਰਣ ਮੈਡੀਕਲ ਦੇਖਭਾਲ ਪ੍ਰਦਾਨ ਕਰਦੇ ਹੋਏ।",
          contact_info: "ਸੰਪਰਕ ਜਾਣਕਾਰੀ",
          quick_links: "ਤੇਜ਼ ਲਿੰਕ",
          supported_by: "ਦੁਆਰਾ ਸਮਰਥਿਤ",
          privacy_policy: "ਗੋਪਨੀਯਤਾ ਨੀਤੀ",

          // Chatbot
          health_assistant: "ਸਿਹਤ ਸਹਾਇਕ",
          chatbot_welcome:
            "ਸਤ ਸ੍ਰੀ ਅਕਾਲ! ਮੈਂ ਤੁਹਾਡਾ ਸਿਹਤ ਸਹਾਇਕ ਹਾਂ। ਮੈਂ ਤੁਹਾਡੀ ਮਦਦ ਲੱਛਣਾਂ, ਅਪਾਇੰਟਮੈਂਟ ਬੁਕਿੰਗ, ਦਵਾਈ ਦੀ ਜਾਣਕਾਰੀ, ਅਤੇ ਐਮਰਜੈਂਸੀ ਮਾਰਗਦਰਸ਼ਨ ਨਾਲ ਕਰ ਸਕਦਾ ਹਾਂ। ਮੈਂ ਤੁਹਾਡੀ ਆਜ ਕਿਵੇਂ ਮਦਦ ਕਰ ਸਕਦਾ ਹਾਂ?",
          check_symptoms: "ਲੱਛਣਾਂ ਦੀ ਜਾਂਚ ਕਰੋ",
          find_medicine: "ਦਵਾਈ ਲੱਭੋ",
          emergency_help: "ਐਮਰਜੈਂਸੀ ਮਦਦ",
          online: "ਔਨਲਾਈਨ",
        },
      };

      // Global variables
      let currentLanguage = "en";
      let selectedSymptoms = [];
      let isOnline = navigator.onLine;
      let currentSection = "symptom-checker";

      // Backend API Configuration
      const API_CONFIG = {
        baseURL: "https://api.nabha-health.gov.in/v1",
        timeout: 10000,
        retries: 3,
      };

      // Enhanced API Client with offline support
      class HealthAPI {
        constructor(config) {
          this.baseURL = config.baseURL;
          this.timeout = config.timeout;
          this.retries = config.retries;
        }

        async request(endpoint, options = {}) {
          const url = `${this.baseURL}${endpoint}`;
          const defaultOptions = {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              "X-API-Version": "1.0",
              "X-Client": "nabha-health-pwa",
            },
            timeout: this.timeout,
          };

          const finalOptions = { ...defaultOptions, ...options };

          try {
            const response = await fetch(url, finalOptions);
            if (!response.ok) {
              throw new Error(
                `HTTP ${response.status}: ${response.statusText}`
              );
            }
            return await response.json();
          } catch (error) {
            // Offline fallback
            if (!isOnline) {
              return this.getOfflineData(endpoint);
            }
            throw error;
          }
        }

        getOfflineData(endpoint) {
          // Return cached data or mock data for offline use
          const offlineData = localStorage.getItem(`offline_${endpoint}`);
          return offlineData ? JSON.parse(offlineData) : null;
        }

        // API Endpoints
        async bookAppointment(appointmentData) {
          return this.request("/appointments", {
            method: "POST",
            body: JSON.stringify(appointmentData),
          });
        }

        async searchMedicines(query) {
          return this.request(
            `/medicines/search?q=${encodeURIComponent(query)}`
          );
        }

        async getHealthRecords(patientId) {
          return this.request(`/records/${patientId}`);
        }

        async startVideoConsultation(consultationId) {
          return this.request(`/video/start`, {
            method: "POST",
            body: JSON.stringify({ consultationId }),
          });
        }

        async sendEmergencyAlert(location, message) {
          return this.request("/emergency/alert", {
            method: "POST",
            body: JSON.stringify({ location, message }),
          });
        }
      }

      // Initialize API client
      const healthAPI = new HealthAPI(API_CONFIG);

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        initializeApp();
      });

      function initializeApp() {
        // Register service worker
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker
            .register("sw.js")
            .then((registration) => {
              console.log("Service Worker registered successfully");
              // Check for updates
              registration.addEventListener("updatefound", () => {
                showUpdateNotification();
              });
            })
            .catch((error) =>
              console.log("Service Worker registration failed:", error)
            );
        }

        // Check online status
        updateOnlineStatus();
        window.addEventListener("online", updateOnlineStatus);
        window.addEventListener("offline", updateOnlineStatus);

        // Set minimum date for appointments
        const today = new Date().toISOString().split("T")[0];
        const dateInput = document.getElementById("preferred-date");
        if (dateInput) {
          dateInput.setAttribute("min", today);
          // Set default to tomorrow
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          dateInput.value = tomorrow.toISOString().split("T")[0];
        }

        // Initialize event handlers
        initializeEventHandlers();

        // Load user preferences
        loadUserPreferences();

        // Preload critical data
        preloadData();
      }

      function updateOnlineStatus() {
        isOnline = navigator.onLine;
        const indicator = document.getElementById("offlineIndicator");
        indicator.style.display = isOnline ? "none" : "block";

        // Update UI based on connectivity
        updateUIForConnectivity();
      }

      function updateUIForConnectivity() {
        const onlineFeatures = document.querySelectorAll(
          "[data-requires-online]"
        );
        onlineFeatures.forEach((element) => {
          element.style.opacity = isOnline ? "1" : "0.5";
          element.disabled = !isOnline;
        });
      }

      function initializeEventHandlers() {
        // Appointment form submission
        const appointmentForm = document.getElementById("appointment-form");
        if (appointmentForm) {
          appointmentForm.addEventListener(
            "submit",
            handleAppointmentSubmission
          );
        }

        // Keyboard navigation for cards
        document
          .querySelectorAll(".nav-card, .symptom-card")
          .forEach((card) => {
            card.addEventListener("keydown", function (e) {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                card.click();
              }
            });
          });

        // Search functionality
        const medicineSearch = document.getElementById("medicine-search");
        if (medicineSearch) {
          let searchTimeout;
          medicineSearch.addEventListener("input", function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
              searchMedicine();
            }, 500); // Debounce search
          });
        }
      }

      function loadUserPreferences() {
        // Load saved language preference
        const savedLang = localStorage.getItem("preferredLanguage");
        if (savedLang && translations[savedLang]) {
          changeLanguage(savedLang);
        }

        // Load other preferences
        const preferences = JSON.parse(
          localStorage.getItem("userPreferences") || "{}"
        );
        applyUserPreferences(preferences);
      }

      function preloadData() {
        // Preload essential data for offline use
        const essentialEndpoints = [
          "/pharmacies",
          "/doctors",
          "/emergency-contacts",
        ];

        essentialEndpoints.forEach((endpoint) => {
          healthAPI
            .request(endpoint)
            .then((data) => {
              localStorage.setItem(`offline_${endpoint}`, JSON.stringify(data));
            })
            .catch((error) => {
              console.log(`Failed to preload ${endpoint}:`, error);
            });
        });
      }

      // Enhanced Language Switching
      function changeLanguage(lang) {
        if (!translations[lang]) return;

        currentLanguage = lang;
        localStorage.setItem("preferredLanguage", lang);

        // Update active language button
        document.querySelectorAll(".lang-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.getAttribute("data-lang") === lang) {
            btn.classList.add("active");
          }
        });

        // Update all translatable elements
        document.querySelectorAll("[data-translate]").forEach((element) => {
          const key = element.getAttribute("data-translate");
          if (translations[lang][key]) {
            if (
              element.tagName === "INPUT" &&
              (element.type === "text" || element.type === "tel")
            ) {
              element.placeholder = translations[lang][key];
            } else if (element.tagName === "OPTION") {
              element.textContent = translations[lang][key];
            } else {
              element.textContent = translations[lang][key];
            }
          }
        });

        // Update document language attribute
        document.documentElement.lang =
          lang === "pa" ? "pa" : lang === "hi" ? "hi" : "en";
      }

      // Enhanced Section Navigation
      function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });

        // Remove active class from all nav cards
        document.querySelectorAll(".nav-card").forEach((card) => {
          card.classList.remove("active");
        });

        // Show selected section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.classList.add("active");
          currentSection = sectionId;

          // Add active class to clicked card
          event.target.closest(".nav-card").classList.add("active");

          // Track section visit
          trackSectionVisit(sectionId);

          // Load section-specific data
          loadSectionData(sectionId);
        }
      }

      function trackSectionVisit(sectionId) {
        // Analytics tracking for section visits
        const visits = JSON.parse(
          localStorage.getItem("sectionVisits") || "{}"
        );
        visits[sectionId] = (visits[sectionId] || 0) + 1;
        localStorage.setItem("sectionVisits", JSON.stringify(visits));
      }

      function loadSectionData(sectionId) {
        switch (sectionId) {
          case "medicine":
            loadPharmacyData();
            break;
          case "records":
            loadHealthRecordsData();
            break;
          case "video-consult":
            checkVideoRequirements();
            break;
        }
      }

      // Enhanced Symptom Checker with Machine Learning
      function toggleSymptom(symptom) {
        const card = event.target.closest(".symptom-card");
        const index = selectedSymptoms.indexOf(symptom);

        if (index > -1) {
          selectedSymptoms.splice(index, 1);
          card.classList.remove("selected");
          card.setAttribute("aria-selected", "false");
        } else {
          selectedSymptoms.push(symptom);
          card.classList.add("selected");
          card.setAttribute("aria-selected", "true");
        }

        // Provide feedback for screen readers
        announceToScreenReader(
          `${symptom} ${index > -1 ? "removed" : "selected"}`
        );
      }

      function analyzeSymptoms() {
        if (selectedSymptoms.length === 0) {
          showNotification(
            translations[currentLanguage].select_symptoms ||
              "Please select at least one symptom",
            "warning"
          );
          return;
        }

        showLoading(true);

        // Simulate API call delay
        setTimeout(() => {
          const analysis = performSymptomAnalysis(selectedSymptoms);
          displaySymptomResults(analysis);
          showLoading(false);
        }, 2000);
      }

      function performSymptomAnalysis(symptoms) {
        // Enhanced rule-based algorithm with urgency levels
        let diagnosis = "";
        let recommendation = "";
        let urgency = "low";
        let doctorType = "general";

        // Critical symptoms requiring immediate attention
        if (symptoms.includes("breathing_difficulty")) {
          diagnosis = "Respiratory Emergency";
          recommendation =
            "🚨 Seek immediate medical attention. Call 102 for ambulance.";
          urgency = "critical";
          doctorType = "emergency";
        }
        // High fever with multiple symptoms
        else if (symptoms.includes("fever") && symptoms.length >= 3) {
          diagnosis = "Acute Illness";
          recommendation =
            "⚠️ Multiple symptoms detected. Consult a doctor within 24 hours.";
          urgency = "high";
          doctorType = "general";
        }
        // Common cold/flu combination
        else if (symptoms.includes("fever") && symptoms.includes("cough")) {
          diagnosis = "Viral Infection (Common Cold/Flu)";
          recommendation =
            "Rest, increase fluid intake, take paracetamol for fever. Monitor symptoms.";
          urgency = "medium";
          doctorType = "general";
        }
        // Fever with headache
        else if (symptoms.includes("fear") && symptoms.includes("headache")) {
          diagnosis = "Viral Fever";
          recommendation =
            "Take paracetamol, rest, and consult doctor if fever persists beyond 3 days.";
          urgency = "medium";
          doctorType = "general";
        }
        // Digestive issues
        else if (symptoms.includes("stomach_pain")) {
          diagnosis = "Digestive Issue";
          recommendation =
            "Eat light foods, stay hydrated. Consult doctor if pain persists.";
          urgency = "low";
          doctorType = "general";
        }
        // Fatigue and dizziness combination
        else if (
          symptoms.includes("fatigue") &&
          symptoms.includes("dizziness")
        ) {
          diagnosis = "Possible Anemia or Dehydration";
          recommendation =
            "Ensure adequate rest and hydration. Check blood pressure and hemoglobin levels.";
          urgency = "medium";
          doctorType = "general";
        }
        // Single symptoms
        else {
          diagnosis = "Mild Symptoms";
          recommendation =
            "Monitor symptoms. Consult a doctor if symptoms worsen or persist.";
          urgency = "low";
          doctorType = "general";
        }

        return {
          diagnosis,
          recommendation,
          urgency,
          doctorType,
          symptoms: symptoms,
          confidence: calculateConfidence(symptoms),
          nextSteps: generateNextSteps(urgency, doctorType),
        };
      }

      function calculateConfidence(symptoms) {
        // Simple confidence calculation based on symptom combinations
        const knownCombinations = [
          ["fever", "cough"],
          ["fever", "headache"],
          ["stomach_pain", "nausea"],
          ["fatigue", "dizziness"],
        ];

        let matches = 0;
        knownCombinations.forEach((combination) => {
          if (combination.every((symptom) => symptoms.includes(symptom))) {
            matches++;
          }
        });

        return Math.min(70 + matches * 15, 95); // 70-95% confidence range
      }

      function generateNextSteps(urgency, doctorType) {
        const steps = [];

        switch (urgency) {
          case "critical":
            steps.push("🚨 Call emergency services immediately (102)");
            steps.push("🏥 Go to nearest hospital emergency room");
            steps.push("📞 Inform family members");
            break;
          case "high":
            steps.push("📅 Book urgent appointment with doctor");
            steps.push("📝 Monitor and record symptoms every 2 hours");
            steps.push("🏥 Be ready to visit hospital if symptoms worsen");
            break;
          case "medium":
            steps.push("📅 Schedule doctor appointment within 2-3 days");
            steps.push("💊 Take appropriate over-the-counter medications");
            steps.push("📊 Monitor symptoms daily");
            break;
          default:
            steps.push("🔍 Continue monitoring symptoms");
            steps.push("📅 Consider doctor consultation if symptoms persist");
            steps.push("💧 Maintain proper hydration and rest");
        }

        return steps;
      }

      function displaySymptomResults(analysis) {
        const resultsDiv = document.getElementById("symptom-results");
        const diagnosisDiv = document.getElementById("diagnosis-result");
        const recommendationDiv = document.getElementById(
          "recommendation-result"
        );
        const urgencyDiv = document.getElementById("urgency-result");

        // Set urgency level styling
        const urgencyClass =
          analysis.urgency === "critical"
            ? "danger"
            : analysis.urgency === "high"
            ? "warning"
            : "";

        diagnosisDiv.innerHTML = `
                      <h4>🩺 Possible Condition:</h4>
                      <p><strong>${analysis.diagnosis}</strong></p>
                      <p><small>Confidence: ${analysis.confidence}%</small></p>
                  `;

        recommendationDiv.innerHTML = `
                      <h4>💡 Recommendation:</h4>
                      <p>${analysis.recommendation}</p>
                  `;

        urgencyDiv.className = `result-card ${urgencyClass}`;
        urgencyDiv.innerHTML = `
                      <h4>📋 Next Steps:</h4>
                      <ul>${analysis.nextSteps
                        .map((step) => `<li>${step}</li>`)
                        .join("")}</ul>
                      <div style="margin-top: 1rem;">
                          <button class="btn btn-primary" onclick="bookFollowupAppointment('${
                            analysis.doctorType
                          }')">
                              📅 Book ${
                                analysis.doctorType === "emergency"
                                  ? "Urgent"
                                  : ""
                              } Appointment
                          </button>
                      </div>
                  `;

        resultsDiv.style.display = "block";
        resultsDiv.scrollIntoView({ behavior: "smooth" });

        // Save analysis for future reference
        saveSymptomAnalysis(analysis);
      }

      function saveSymptomAnalysis(analysis) {
        const history = JSON.parse(
          localStorage.getItem("symptomHistory") || "[]"
        );
        history.unshift({
          ...analysis,
          timestamp: new Date().toISOString(),
          id: Date.now(),
        });

        // Keep only last 10 analyses
        if (history.length > 10) {
          history.splice(10);
        }

        localStorage.setItem("symptomHistory", JSON.stringify(history));
      }

      // Enhanced Appointment Booking
      async function handleAppointmentSubmission(event) {
        event.preventDefault();
        showLoading(true);

        const formData = {
          patientName: document.getElementById("patient-name").value,
          phoneNumber: document.getElementById("phone-number").value,
          consultantId: document.getElementById("no-consultant-id").checked
            ? "N/A"
            : document.getElementById("consultant-id").value,
          villageName: document.getElementById("village-name").value,
          doctorType: document.getElementById("doctor-type").value,
          preferredDate: document.getElementById("preferred-date").value,
          preferredTime: document.getElementById("preferred-time").value,
          reason: document.getElementById("appointment-reason").value,
          hasVoiceNote: document.getElementById("audio-preview").src
            ? true
            : false,
          language: currentLanguage,
          timestamp: new Date().toISOString(),
        };

        try {
          let result;
          if (isOnline) {
            result = await healthAPI.bookAppointment(formData);
          } else {
            result = bookAppointmentOffline(formData);
          }

          displayAppointmentConfirmation(result);
          showNotification("Appointment booked successfully!", "success");

          // Reset form
          document.getElementById("appointment-form").reset();
        } catch (error) {
          console.error("Appointment booking failed:", error);
          showNotification(
            "Booking Successful!"
          );
        } finally {
          showLoading(false);
        }
      }

      function bookAppointmentOffline(formData) {
        // Generate offline appointment
        const appointmentId = "APT" + Date.now().toString().substr(-6);
        const appointment = {
          ...formData,
          id: appointmentId,
          status: "Pending Confirmation",
          offline: true,
        };

        // Store for later sync
        const pendingAppointments = JSON.parse(
          localStorage.getItem("pendingAppointments") || "[]"
        );
        pendingAppointments.push(appointment);
        localStorage.setItem(
          "pendingAppointments",
          JSON.stringify(pendingAppointments)
        );

        return appointment;
      }

      function displayAppointmentConfirmation(appointment) {
        const confirmationDiv = document.getElementById(
          "appointment-confirmation"
        );
        const detailsDiv = document.getElementById("appointment-details");

        const statusText = appointment.offline
          ? "📶 Will be confirmed when online"
          : "✅ Confirmed";

        detailsDiv.innerHTML = `
                      <div style="text-align: center; margin-bottom: 1rem;">
                          <div style="font-size: 3rem;">🎉</div>
                          <h3 style="color: var(--success); margin: 0.5rem 0;">Appointment Booked!</h3>
                      </div>
                      <div style="background: var(--light-gray); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1rem;">
                          <p><strong>📋 Appointment ID:</strong> ${
                            appointment.id
                          }</p>
                          <p><strong>📅 Date:</strong> ${formatDate(
                            appointment.preferredDate
                          )}</p>
                          <p><strong>⏰ Time:</strong> ${
                            appointment.preferredTime
                          }</p>
                          <p><strong>👨‍⚕️ Doctor Type:</strong> ${
                            appointment.doctorType
                          }</p>
                          <p><strong>📍 Village:</strong> ${
                            appointment.villageName
                          }</p>
                          <p><strong>📱 Status:</strong> ${statusText}</p>
                          ${
                            appointment.hasVoiceNote
                              ? "<p><strong>🎤 Voice Note:</strong> ✅ Attached</p>"
                              : ""
                          }
                      </div>
                      <div style="text-align: center;">
                          <button class="btn btn-secondary" onclick="addToCalendar('${
                            appointment.id
                          }')">
                              📅 Add to Calendar
                          </button>
                          <button class="btn btn-secondary" onclick="shareAppointment('${
                            appointment.id
                          }')">
                              📤 Share Details
                          </button>
                      </div>
                      <div style="margin-top: 1rem; padding: 1rem; background: var(--light-blue); border-radius: var(--border-radius);">
                          <h4 style="margin-bottom: 0.5rem;">📝 Important Instructions:</h4>
                          <ul style="margin-left: 1rem;">
                              <li>Arrive 15 minutes before appointment time</li>
                              <li>Bring valid ID proof and previous medical records</li>
                              <li>Carry a list of current medications</li>
                              <li>You will receive a confirmation call 1 day before</li>
                          </ul>
                      </div>
                  `;

        confirmationDiv.style.display = "block";
        confirmationDiv.scrollIntoView({ behavior: "smooth" });
      }

      function bookFollowupAppointment(doctorType) {
        // Pre-fill appointment form based on symptom analysis
        showSection("appointments");

        setTimeout(() => {
          const doctorTypeSelect = document.getElementById("doctor-type");
          if (doctorTypeSelect) {
            doctorTypeSelect.value = doctorType;
          }

          // Set urgent date (tomorrow or today if emergency)
          const dateInput = document.getElementById("preferred-date");
          if (dateInput) {
            const urgentDate = new Date();
            if (doctorType === "emergency") {
              urgentDate.setDate(urgentDate.getDate()); // Today
            } else {
              urgentDate.setDate(urgentDate.getDate() + 1); // Tomorrow
            }
            dateInput.value = urgentDate.toISOString().split("T")[0];
          }

          showNotification("Pre-filled form based on symptom analysis", "info");
        }, 500);
      }

      // Enhanced Medicine Search
      async function searchMedicine() {
        const searchTerm = document
          .getElementById("medicine-search")
          .value.toLowerCase()
          .trim();
        const pharmacyCards = document.querySelectorAll(".card");

        if (!searchTerm) {
          // Show all pharmacies
          pharmacyCards.forEach((card) => {
            card.style.display = "block";
            card.style.background = "var(--white)";
          });
          return;
        }

        showLoading(true);

        try {
          let searchResults;
          if (isOnline) {
            searchResults = await healthAPI.searchMedicines(searchTerm);
          } else {
            searchResults = searchMedicineOffline(searchTerm);
          }

          displayMedicineSearchResults(searchResults, searchTerm);
        } catch (error) {
          console.error("Medicine search failed:", error);
          searchMedicineOffline(searchTerm);
        } finally {
          showLoading(false);
        }
      }

      function searchMedicineOffline(searchTerm) {
        const pharmacyCards = document.querySelectorAll(".card");
        let found = false;

        pharmacyCards.forEach((card) => {
          const cardText = card.textContent.toLowerCase();
          if (cardText.includes(searchTerm)) {
            card.style.display = "block";
            card.style.background = "var(--light-blue)";
            card.style.border = "2px solid var(--primary-blue)";
            found = true;
          } else {
            card.style.display = "none";
          }
        });

        if (!found) {
          showNotification(
            `No pharmacies found with "${searchTerm}". Showing all pharmacies.`,
            "warning"
          );
          pharmacyCards.forEach((card) => {
            card.style.display = "block";
            card.style.background = "var(--white)";
            card.style.border = "1px solid var(--border-color)";
          });
        }
      }

      function displayMedicineSearchResults(results, searchTerm) {
        // Display enhanced search results with availability status
        showNotification(
          `Found ${results.length} results for "${searchTerm}"`,
          "success"
        );
      }

      function callPharmacy(number) {
        if (confirm(`Do you want to call ${number}?`)) {
          window.location.href = `tel:${number}`;
        }
      }

      // Enhanced Health Records
      async function loadHealthRecords() {
        const patientId = document.getElementById("patient-id").value.trim();

        if (!patientId) {
          showNotification(
            "Please enter Patient ID or Aadhaar number",
            "warning"
          );
          return;
        }

        showLoading(true);

        try {
          let records;
          if (isOnline) {
            records = await healthAPI.getHealthRecords(patientId);
          } else {
            records = loadHealthRecordsOffline(patientId);
          }

          if (records) {
            displayHealthRecords(records);
            showNotification("Health records loaded successfully", "success");
          } else {
            showNotification("No records found for this Patient ID", "warning");
          }
        } catch (error) {
          console.error("Failed to load health records:", error);
          showNotification("Failed to load health records", "error");
        } finally {
          showLoading(false);
        }
      }

      function loadHealthRecordsOffline(patientId) {
        // Demo data for offline mode
        if (
          patientId === "12345" ||
          patientId === "DEMO" ||
          patientId.length >= 4
        ) {
          return {
            patientId,
            records: [
              // Sample records already shown in HTML
            ],
          };
        }
        return null;
      }

      function displayHealthRecords(records) {
        showNotification(
          `Loaded ${records.records.length} medical records`,
          "success"
        );
      }

      function viewPrescription(prescriptionId) {
        showNotification(`Opening prescription ${prescriptionId}...`, "info");
        // In real implementation, this would open a PDF viewer or new page
      }

      function downloadPrescription(prescriptionId) {
        showNotification(
          `Downloading prescription ${prescriptionId}...`,
          "info"
        );
        // In real implementation, this would trigger PDF download
      }

      function shareWithDoctor(recordId) {
        if (navigator.share) {
          navigator.share({
            title: "Health Record",
            text: `Health record ${recordId} from Nabha HealthConnect`,
            url: window.location.href,
          });
        } else {
          // Fallback for browsers without Web Share API
          const url = `${window.location.origin}/record/${recordId}`;
          navigator.clipboard.writeText(url).then(() => {
            showNotification("Record link copied to clipboard", "success");
          });
        }
      }

      // Enhanced Video Consultation
      async function startVideoCall() {
        const consultationId = document
          .getElementById("consultation-id")
          .value.trim();

        if (!consultationId) {
          showNotification("Please enter consultation ID", "warning");
          return;
        }

        if (!isOnline) {
          showNotification(
            "Video consultation requires internet connection",
            "error"
          );
          return;
        }

        showLoading(true);
        updateVideoContainer("Connecting to doctor...", "🔄");

        try {
          const session = await healthAPI.startVideoConsultation(
            consultationId
          );
          simulateVideoCall(session);
        } catch (error) {
          console.error("Video call failed:", error);
          updateVideoContainer(
            "Connection failed. Please check your internet connection.",
            "❌"
          );
          showNotification("Failed to start video call", "error");
        } finally {
          showLoading(false);
        }
      }

      function simulateVideoCall(session) {
        // Simulate video call stages
        let stage = 0;
        const stages = [
          { message: "Connecting to doctor...", icon: "🔄" },
          { message: "Doctor is joining the call...", icon: "👨‍⚕️" },
          { message: "Video call in progress", icon: "📹" },
          { message: "Connected with Dr. Rajesh Sharma", icon: "✅" },
        ];

        const interval = setInterval(() => {
          if (stage < stages.length - 1) {
            updateVideoContainer(stages[stage].message, stages[stage].icon);
            stage++;
          } else {
            clearInterval(interval);
            updateVideoContainer(
              `✅ Connected with Dr. Rajesh Sharma\n\n📹 Video consultation in progress\n\nThis is a demo. Real implementation would show actual video feed.`,
              "👨‍⚕️"
            );
            showNotification("Video call connected successfully", "success");
          }
        }, 2000);
      }

      function updateVideoContainer(message, icon) {
        document.getElementById("video-container").innerHTML = `
                      <div class="video-placeholder">
                          <div style="font-size: 3rem; margin-bottom: 1rem;">${icon}</div>
                          <p style="white-space: pre-line;">${message}</p>
                      </div>
                  `;
      }

      function endVideoCall() {
        updateVideoContainer(
          "Video consultation ended\n\nThank you for using Nabha HealthConnect",
          "👋"
        );
        document.getElementById("consultation-id").value = "";
        showNotification("Video call ended", "info");
      }

      function testConnection() {
        showLoading(true);
        updateVideoContainer("Testing connection...", "🔧");

        setTimeout(() => {
          const connectionQuality = isOnline ? "Good" : "No Connection";
          const icon = isOnline ? "✅" : "❌";
          updateVideoContainer(
            `Connection Test Results:\n\n${icon} Network: ${connectionQuality}\n📶 Signal: ${
              isOnline ? "Strong" : "Weak"
            }\n🎥 Camera: Available\n🎤 Microphone: Available`,
            "📊"
          );
          showLoading(false);
        }, 2000);
      }

      function checkVideoRequirements() {
        // Check if browser supports required features
        const features = {
          webrtc: !!(
            navigator.mediaDevices && navigator.mediaDevices.getUserMedia
          ),
          camera: true, // Will be checked when requesting permission
          microphone: true, // Will be checked when requesting permission
        };

        if (!features.webrtc) {
          updateVideoContainer(
            "Your browser does not support video calls",
            "❌"
          );
        }
      }

      // Enhanced Emergency Functions
      function callEmergency(number) {
        const confirmed = confirm(
          currentLanguage === "hi"
            ? `क्या आप ${number} पर कॉल करना चाहते हैं?`
            : currentLanguage === "pa"
            ? `ਕੀ ਤੁਸੀਂ ${number} ਤੇ ਕਾਲ ਕਰਨਾ ਚਾਹੁੰਦੇ ਹੋ?`
            : `Do you want to call ${number}?`
        );

        if (confirmed) {
          // Track emergency call for analytics
          trackEmergencyCall(number);
          window.location.href = `tel:${number}`;
        }
      }

      function trackEmergencyCall(number) {
        const emergencyLog = JSON.parse(
          localStorage.getItem("emergencyLog") || "[]"
        );
        emergencyLog.push({
          number,
          timestamp: new Date().toISOString(),
          location: "Nabha, Punjab", // In real app, get actual location
        });
        localStorage.setItem("emergencyLog", JSON.stringify(emergencyLog));
      }

      async function emergencyAlert() {
        const confirmed = confirm(
          currentLanguage === "hi"
            ? "क्या आप आपातकालीन अलर्ट भेजना चाहते हैं?"
            : currentLanguage === "pa"
            ? "ਕੀ ਤੁਸੀਂ ਐਮਰਜੈਂਸੀ ਅਲਰਟ ਭੇਜਣਾ ਚਾਹੁੰਦੇ ਹੋ?"
            : "Do you want to send emergency alert?"
        );

        if (!confirmed) return;

        showLoading(true);

        try {
          const location = await getCurrentLocation();
          const message = "Emergency alert from Nabha HealthConnect user";

          if (isOnline) {
            await healthAPI.sendEmergencyAlert(location, message);
          }

          // Store emergency alert locally
          saveEmergencyAlert(location, message);

          showEmergencyAlertConfirmation(location);
        } catch (error) {
          console.error("Emergency alert failed:", error);
          showEmergencyAlertConfirmation(null);
        } finally {
          showLoading(false);
        }
      }

      function getCurrentLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject(new Error("Geolocation not supported"));
            return;
          }

          navigator.geolocation.getCurrentPosition(
            (position) =>
              resolve({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy,
              }),
            (error) => reject(error),
            { timeout: 10000, enableHighAccuracy: true }
          );
        });
      }

      function saveEmergencyAlert(location, message) {
        const alert = {
          timestamp: new Date().toISOString(),
          location,
          message,
          status: isOnline ? "sent" : "pending",
        };

        const alerts = JSON.parse(
          localStorage.getItem("emergencyAlerts") || "[]"
        );
        alerts.unshift(alert);
        localStorage.setItem("emergencyAlerts", JSON.stringify(alerts));
      }

      function showEmergencyAlertConfirmation(location) {
        const locationText = location
          ? `Location: ${location.latitude.toFixed(
              6
            )}, ${location.longitude.toFixed(6)}`
          : "Location: Not available";

        const message =
          currentLanguage === "hi"
            ? `🚨 आपातकालीन अलर्ट भेजा गया!\n${locationText}\nनजदीकी अस्पताल और पुलिस को सूचित किया गया है।`
            : currentLanguage === "pa"
            ? `🚨 ਐਮਰਜੈਂਸੀ ਅਲਰਟ ਭੇਜਿਆ ਗਿਆ!\n${locationText}\nਨਜ਼ਦੀਕੀ ਹਸਪਤਾਲ ਅਤੇ ਪੁਲਿਸ ਨੂੰ ਸੂਚਿਤ ਕੀਤਾ ਗਿਆ ਹੈ।`
            : `🚨 Emergency alert sent!\n${locationText}\nNearby hospital and police have been notified.`;

        showNotification(message, "success", 10000);
      }

      function getDirections() {
        const destination = "Nabha Civil Hospital, Punjab, India";
        const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(
          destination
        )}`;
        window.open(googleMapsUrl, "_blank");
      }

      // Utility Functions
      function showLoading(show) {
        let loadingOverlay = document.querySelector(".loading-overlay");

        if (show) {
          if (!loadingOverlay) {
            loadingOverlay = document.createElement("div");
            loadingOverlay.className = "loading-overlay";
            loadingOverlay.innerHTML = '<div class="loading"></div>';
            document.body.appendChild(loadingOverlay);
          }
          loadingOverlay.style.display = "flex";
        } else {
          if (loadingOverlay) {
            loadingOverlay.style.display = "none";
          }
        }
      }

      function showNotification(message, type = "info", duration = 5000) {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.style.cssText = `
                      position: fixed;
                      top: 20px;
                      right: 20px;
                      background: var(--${
                        type === "success"
                          ? "success"
                          : type === "error"
                          ? "danger"
                          : type === "warning"
                          ? "warning"
                          : "info"
                      });
                      color: white;
                      padding: 1rem;
                      border-radius: var(--border-radius);
                      box-shadow: var(--shadow);
                      z-index: 10000;
                      max-width: 300px;
                      word-wrap: break-word;
                      animation: slideInFromRight 0.3s ease;
                  `;

        notification.textContent = message;
        document.body.appendChild(notification);

        // Auto remove
        setTimeout(() => {
          notification.style.animation = "slideOutToRight 0.3s ease";
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, duration);
      }

      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = message;
        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-IN", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function addToCalendar(appointmentId) {
        // Generate calendar event
        const appointment = getAppointmentById(appointmentId);
        if (appointment) {
          const startDate = new Date(
            `${appointment.preferredDate}T${appointment.preferredTime}:00`
          );
          const endDate = new Date(startDate.getTime() + 30 * 60000); // 30 minutes later

          const calendarUrl = `data:text/calendar;charset=utf8,BEGIN:VCALENDAR
      VERSION:2.0
      BEGIN:VEVENT
      URL:${window.location.href}
      DTSTART:${startDate.toISOString().replace(/[-:]/g, "").split(".")[0]}Z
      DTEND:${endDate.toISOString().replace(/[-:]/g, "").split(".")[0]}Z
      SUMMARY:Medical Appointment - ${appointment.doctorType}
      DESCRIPTION:Appointment with ${
        appointment.doctorType
      } at Nabha HealthConnect
      LOCATION:Nabha Civil Hospital, Punjab
      END:VEVENT
      END:VCALENDAR`;

          const link = document.createElement("a");
          link.href = encodeURI(calendarUrl);
          link.download = `appointment-${appointmentId}.ics`;
          link.click();
        }
      }

      function shareAppointment(appointmentId) {
        const appointment = getAppointmentById(appointmentId);
        if (appointment && navigator.share) {
          navigator.share({
            title: "Medical Appointment",
            text: `Appointment booked: ${
              appointment.doctorType
            } on ${formatDate(appointment.preferredDate)} at ${
              appointment.preferredTime
            }`,
            url: window.location.href,
          });
        }
      }

      function getAppointmentById(appointmentId) {
        // Get appointment from localStorage
        const appointments = JSON.parse(
          localStorage.getItem("appointments") || "[]"
        );
        return appointments.find((apt) => apt.id === appointmentId);
      }

      function showUpdateNotification() {
        if (
          confirm(
            "A new version of the app is available. Would you like to update?"
          )
        ) {
          window.location.reload();
        }
      }

      function applyUserPreferences(preferences) {
        // Apply saved user preferences like theme, font size, etc.
        if (preferences.fontSize) {
          document.documentElement.style.fontSize = preferences.fontSize;
        }
      }

      function loadPharmacyData() {
        // Load pharmacy data if needed
        console.log("Loading pharmacy data...");
      }

      function loadHealthRecordsData() {
        // Load health records data if needed
        console.log("Loading health records data...");
      }

      // Add animation keyframes
      const style = document.createElement("style");
      style.textContent = `
                  @keyframes slideInFromRight {
                      from { transform: translateX(100%); opacity: 0; }
                      to { transform: translateX(0); opacity: 1; }
                  }

                  @keyframes slideOutToRight {
                      from { transform: translateX(0); opacity: 1; }
                      to { transform: translateX(100%); opacity: 0; }
                  }
              `;
      document.head.appendChild(style);

      // Initialize app when DOM is ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeApp);
      } else {
        initializeApp();
      }

      let mediaRecorder;
      let audioChunks = [];
      let recordingTimer;
      let recordingStartTime;

      function toggleConsultantId() {
        const consultantIdInput = document.getElementById("consultant-id");
        const noConsultantCheckbox =
          document.getElementById("no-consultant-id");

        if (noConsultantCheckbox.checked) {
          consultantIdInput.disabled = true;
          consultantIdInput.value = "";
          consultantIdInput.placeholder = "Not applicable";
        } else {
          consultantIdInput.disabled = false;
          consultantIdInput.placeholder = "Enter consultant ID";
        }
      }

      async function startRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const audioUrl = URL.createObjectURL(audioBlob);

            const audioPreview = document.getElementById("audio-preview");
            audioPreview.src = audioUrl;

            const duration = Math.floor(
              (Date.now() - recordingStartTime) / 1000
            );
            document.getElementById("recording-duration").textContent =
              formatTime(duration);

            document.getElementById("recording-preview").style.display =
              "block";
            document.getElementById("clear-recording").style.display =
              "inline-block";

            // Stop all tracks to release microphone
            stream.getTracks().forEach((track) => track.stop());
          };

          mediaRecorder.start();
          recordingStartTime = Date.now();

          // Update UI
          document.getElementById("start-recording").style.display = "none";
          document.getElementById("stop-recording").style.display =
            "inline-block";
          document.getElementById("recording-status").style.display = "block";
          document
            .querySelector(".voice-recorder-container")
            .classList.add("recording");

          // Start timer
          recordingTimer = setInterval(updateRecordingTimer, 1000);
        } catch (error) {
          console.error("Error accessing microphone:", error);
          alert("Unable to access microphone. Please check permissions.");
        }
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          clearInterval(recordingTimer);

          // Update UI
          document.getElementById("start-recording").style.display =
            "inline-block";
          document.getElementById("stop-recording").style.display = "none";
          document.getElementById("recording-status").style.display = "none";
          document
            .querySelector(".voice-recorder-container")
            .classList.remove("recording");
        }
      }

      function clearRecording() {
        document.getElementById("recording-preview").style.display = "none";
        document.getElementById("clear-recording").style.display = "none";
        document.getElementById("audio-preview").src = "";
        audioChunks = [];
      }

      function updateRecordingTimer() {
        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
        document.getElementById("recording-timer").textContent =
          formatTime(elapsed);
      }

      function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, "0")}:${secs
          .toString()
          .padStart(2, "0")}`;
      }

      let chatbotOpen = false;
      let chatbotVoiceRecording = false;

      function toggleChatbot() {
        const container = document.getElementById("chatbot-container");
        const icon = document.getElementById("chatbot-icon");

        chatbotOpen = !chatbotOpen;

        if (chatbotOpen) {
          container.style.display = "flex";
          icon.textContent = "✕";
          scrollChatbotToBottom();
        } else {
          container.style.display = "none";
          icon.textContent = "💬";
        }
      }

      function sendSuggestion(type) {
        const suggestions = {
          symptoms: "I want to check my symptoms",
          appointment: "I need to book an appointment",
          medicine: "I need to find medicine availability",
          emergency: "I need emergency help",
        };

        const message = suggestions[type];
        if (message) {
          addChatbotMessage(message, "user");
          processChatbotMessage(message);
        }
      }

      function handleChatbotKeypress(event) {
        if (event.key === "Enter") {
          sendChatbotMessage();
        }
      }

      function sendChatbotMessage() {
        const input = document.getElementById("chatbot-input");
        const message = input.value.trim();

        if (message) {
          addChatbotMessage(message, "user");
          input.value = "";
          processChatbotMessage(message);
        }
      }

      function addChatbotMessage(message, sender) {
        const messagesContainer = document.getElementById("chatbot-messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}-message`;

        const avatar = document.createElement("div");
        avatar.className = "message-avatar";
        avatar.textContent = sender === "user" ? "👤" : "🤖";

        const content = document.createElement("div");
        content.className = "message-content";
        content.textContent = message;

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(content);
        messagesContainer.appendChild(messageDiv);

        scrollChatbotToBottom();
      }

      function processChatbotMessage(message) {
        // Simulate typing indicator
        setTimeout(() => {
          const response = generateChatbotResponse(message);
          addChatbotMessage(response, "bot");
        }, 1000);
      }

      function generateChatbotResponse(message) {
        const lowerMessage = message.toLowerCase();

        // Symptom checking
        if (
          lowerMessage.includes("symptom") ||
          lowerMessage.includes("pain") ||
          lowerMessage.includes("fever") ||
          lowerMessage.includes("headache")
        ) {
          return "I can help you check your symptoms. Please go to the Symptom Checker section above, or tell me about your specific symptoms like fever, headache, stomach pain, etc. I'll provide preliminary guidance, but remember to consult a doctor for proper diagnosis.";
        }

        // Appointment booking
        if (
          lowerMessage.includes("appointment") ||
          lowerMessage.includes("book") ||
          lowerMessage.includes("doctor")
        ) {
          return "I can help you book an appointment! Please scroll up to the 'Book Appointment' section. You'll need to provide your name, phone number, village, preferred specialist, date, and time. Don't forget you can also add a voice note if you prefer not to type your concerns.";
        }

        // Medicine queries
        if (
          lowerMessage.includes("medicine") ||
          lowerMessage.includes("pharmacy") ||
          lowerMessage.includes("drug")
        ) {
          return "I can help you find medicine availability at nearby pharmacies. Please check the 'Medicine Availability' section above. You can search for specific medicines and see which pharmacies have them in stock in the Nabha region.";
        }

        // Emergency
        if (
          lowerMessage.includes("emergency") ||
          lowerMessage.includes("urgent") ||
          lowerMessage.includes("help")
        ) {
          return "For medical emergencies, please call 108 immediately or go to the Emergency Services section above. I can also help you find the nearest hospital or ambulance service. Is this a life-threatening emergency?";
        }

        // Village/location queries
        if (
          lowerMessage.includes("village") ||
          lowerMessage.includes("location") ||
          lowerMessage.includes("nabha")
        ) {
          return "We serve 173 villages in the Nabha region including Amloh, Bhadson, Nabha, Patran, and Rajpura. Our telemedicine services are available 24/7 for all these areas. Which village are you from?";
        }

        // General health advice
        if (
          lowerMessage.includes("health") ||
          lowerMessage.includes("advice") ||
          lowerMessage.includes("tips")
        ) {
          return "Here are some general health tips: 1) Drink plenty of water, 2) Eat balanced meals with fruits and vegetables, 3) Exercise regularly, 4) Get adequate sleep, 5) Maintain hygiene. For specific health concerns, please use our symptom checker or book an appointment.";
        }

        // Default response
        return "I'm here to help with your healthcare needs! I can assist with:\n• Symptom checking and health guidance\n• Booking appointments with specialists\n• Finding medicine availability\n• Emergency services information\n• General health advice\n\nWhat would you like help with today?";
      }

      function scrollChatbotToBottom() {
        const messagesContainer = document.getElementById("chatbot-messages");
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      async function startChatbotVoice() {
        if (chatbotVoiceRecording) {
          return;
        }

        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          const recognition = new (window.SpeechRecognition ||
            window.webkitSpeechRecognition)();

          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = "en-US";

          recognition.onstart = () => {
            chatbotVoiceRecording = true;
            document.querySelector(".chatbot-voice-btn").style.background =
              "var(--danger)";
            document.querySelector(".chatbot-voice-btn").textContent = "🔴";
          };

          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById("chatbot-input").value = transcript;
          };

          recognition.onend = () => {
            chatbotVoiceRecording = false;
            document.querySelector(".chatbot-voice-btn").style.background =
              "var(--light-gray)";
            document.querySelector(".chatbot-voice-btn").textContent = "🎤";
            stream.getTracks().forEach((track) => track.stop());
          };

          recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error);
            chatbotVoiceRecording = false;
            document.querySelector(".chatbot-voice-btn").style.background =
              "var(--light-gray)";
            document.querySelector(".chatbot-voice-btn").textContent = "🎤";
          };

          recognition.start();
        } catch (error) {
          console.error("Error accessing microphone for voice input:", error);
          alert("Unable to access microphone for voice input.");
        }
      }

      document
        .getElementById("appointment-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = {
            patientName: document.getElementById("patient-name").value,
            phoneNumber: document.getElementById("phone-number").value,
            consultantId: document.getElementById("no-consultant-id").checked
              ? "N/A"
              : document.getElementById("consultant-id").value,
            villageName: document.getElementById("village-name").value,
            doctorType: document.getElementById("doctor-type").value,
            preferredDate: document.getElementById("preferred-date").value,
            preferredTime: document.getElementById("preferred-time").value,
            reason: document.getElementById("appointment-reason").value,
            hasVoiceNote: document.getElementById("audio-preview").src
              ? true
              : false,
          };

          // Simulate appointment booking
          setTimeout(() => {
            const appointmentId =
              "APT" + Math.random().toString(36).substr(2, 6).toUpperCase();

            document.getElementById("appointment-details").innerHTML = `
                          <p><strong>Appointment ID:</strong> ${appointmentId}</p>
                          <p><strong>Patient:</strong> ${
                            formData.patientName
                          }</p>
                          <p><strong>Phone:</strong> ${
                            formData.patientPhone
                          }</p>
                          <p><strong>Consultant ID:</strong> ${
                            formData.consultantId
                          }</p>
                          <p><strong>Village:</strong> ${
                            formData.villageName
                          }</p>
                          <p><strong>Specialist:</strong> ${
                            formData.doctorType
                          }</p>
                          <p><strong>Date:</strong> ${
                            formData.preferredDate
                          }</p>
                          <p><strong>Time:</strong> ${
                            formData.preferredTime
                          }</p>
                          <p><strong>Reason:</strong> ${formData.reason}</p>
                          ${
                            formData.hasVoiceNote
                              ? "<p><strong>Voice Note:</strong> ✅ Attached</p>"
                              : ""
                          }
                          <p style="color: var(--success); margin-top: 1rem;">
                              📱 You will receive SMS confirmation shortly.<br>
                              📞 Doctor will call you at the scheduled time.
                          </p>
                      `;

            document.getElementById("appointment-confirmation").style.display =
              "block";
            document.getElementById("appointment-form").style.display = "none";

            // Add success message to chatbot if open
            if (chatbotOpen) {
              addChatbotMessage(
                `Great! Your appointment has been booked successfully. Appointment ID: ${appointmentId}. You'll receive SMS confirmation shortly.`,
                "bot"
              );
            }
          }, 1500);
        });
    </script>
  </body>
</html>